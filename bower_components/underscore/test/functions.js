$(document).ready(function(){module("Functions");test("bind",function(){var a={name:"moe"};var e=function(f){return"name: "+(this.name||f)};var c=_.bind(e,a);equal(c(),"name: moe","can bind a function to a context");c=_(e).bind(a);equal(c(),"name: moe","can do OO-style binding");c=_.bind(e,null,"curly");equal(c(),"name: curly","can bind without specifying a context");e=function(g,f){return g+": "+f};e=_.bind(e,this,"hello");equal(e("moe"),"hello: moe","the function was partially applied in advance");e=_.bind(e,this,"curly");equal(e(),"hello: curly","the function was completely applied in advance");e=function(h,g,f){return h+": "+g+" "+f};e=_.bind(e,this,"hello","moe","curly");equal(e(),"hello: moe curly","the function was partially applied in advance and can accept multiple arguments");e=function(f,g){equal(this,f,g)};_.bind(e,0,0,"can bind a function to `0`")();_.bind(e,"","","can bind a function to an empty string")();_.bind(e,false,false,"can bind a function to `false`")();var d=function(){return this};var b=_.bind(d,{hello:"moe curly"});equal(b().hello,"moe curly","When called without the new operator, it's OK to be bound to the context")});test("partial",function(){var b={name:"moe"};var a=function(){return this.name+" "+_.toArray(arguments).join(" ")};b.func=_.partial(a,"a","b");equal(b.func("c","d"),"moe a b c d","can partially apply")});test("bindAll",function(){var a={name:"curly"},b={name:"moe",getName:function(){return"name: "+this.name},sayHi:function(){return"hi: "+this.name}};a.getName=b.getName;_.bindAll(b,"getName","sayHi");a.sayHi=b.sayHi;equal(a.getName(),"name: curly","unbound function is bound to current object");equal(a.sayHi(),"hi: moe","bound function is still bound to original object");a={name:"curly"};b={name:"moe",getName:function(){return"name: "+this.name},sayHi:function(){return"hi: "+this.name}};_.bindAll(b);a.sayHi=b.sayHi;equal(a.sayHi(),"hi: moe","calling bindAll with no arguments binds all functions to the object")});test("memoize",function(){var a=function(e){return e<2?e:a(e-1)+a(e-2)};var c=_.memoize(a);equal(a(10),55,"a memoized version of fibonacci produces identical results");equal(c(10),55,"a memoized version of fibonacci produces identical results");var d=function(e){return e};var b=_.memoize(d);equal(d("toString"),"toString","checks hasOwnProperty");equal(b("toString"),"toString","checks hasOwnProperty")});asyncTest("delay",2,function(){var a=false;_.delay(function(){a=true},100);setTimeout(function(){ok(!a,"didn't delay the function quite yet")},50);setTimeout(function(){ok(a,"delayed the function");start()},150)});asyncTest("defer",1,function(){var a=false;_.defer(function(b){a=b},true);_.delay(function(){ok(a,"deferred the function");start()},50)});asyncTest("throttle",2,function(){var a=0;var c=function(){a++};var b=_.throttle(c,32);b();b();equal(a,1,"incr was called immediately");_.delay(function(){equal(a,2,"incr was throttled");start()},64)});asyncTest("throttle arguments",2,function(){var a=0;var c=function(d){a=d};var b=_.throttle(c,32);b(1);b(2);_.delay(function(){b(3)},64);equal(a,1,"updated to latest value");_.delay(function(){equal(a,3,"updated to latest value");start()},96)});asyncTest("throttle once",2,function(){var b=0;var d=function(){return ++b};var c=_.throttle(d,32);var a=c();_.delay(function(){equal(a,1,"throttled functions return their value");equal(b,1,"incr was called once");start()},64)});asyncTest("throttle twice",1,function(){var a=0;var c=function(){a++};var b=_.throttle(c,32);b();b();_.delay(function(){equal(a,2,"incr was called twice");start()},64)});asyncTest("throttle repeatedly with results",6,function(){var a=0;var e=function(){return ++a};var d=_.throttle(e,64);var c=[];var b=function(){c.push(d())};b();b();_.delay(b,32);_.delay(b,80);_.delay(b,96);_.delay(b,144);_.delay(function(){equal(c[0],1,"incr was called once");equal(c[1],1,"incr was throttled");equal(c[2],1,"incr was throttled");equal(c[3],2,"incr was called twice");equal(c[4],2,"incr was throttled");equal(c[5],3,"incr was called trailing");start()},192)});asyncTest("throttle triggers trailing call when invoked repeatedly",2,function(){var b=0;var a=48;var f=function(){b++};var e=_.throttle(f,32);var d=new Date;while((new Date-d)<a){e()}var c=b;ok(b>1);_.delay(function(){ok(b>c);start()},96)});asyncTest("debounce",1,function(){var a=0;var c=function(){a++};var b=_.debounce(c,32);b();b();_.delay(b,16);_.delay(function(){equal(a,1,"incr was debounced");start()},96)});asyncTest("debounce asap",4,function(){var e,c;var d=0;var g=function(){return ++d};var f=_.debounce(g,64,true);e=f();c=f();equal(e,1);equal(c,1);equal(d,1,"incr was called immediately");_.delay(f,16);_.delay(f,32);_.delay(f,48);_.delay(function(){equal(d,1,"incr was debounced");start()},128)});asyncTest("debounce asap recursively",2,function(){var a=0;var b=_.debounce(function(){a++;if(a<10){b()}},32,true);b();equal(a,1,"incr was called immediately");_.delay(function(){equal(a,1,"incr was debounced");start()},96)});test("once",function(){var b=0;var a=_.once(function(){b++});a();a();equal(b,1)});test("wrap",function(){var b=function(h){return"hi: "+h};var a=_.wrap(b,function(i,h){return i(h)+" "+h.split("").reverse().join("")});equal(a("moe"),"hi: moe eom","wrapped the saluation function");var d=function(){return"Hello "};var g={name:"Moe"};g.hi=_.wrap(d,function(h){return h()+this.name});equal(g.hi(),"Hello Moe");var f=function(){};var c=_.wrap(f,function(h){return Array.prototype.slice.call(arguments,0)});var e=c(["whats","your"],"vector","victor");deepEqual(e,[f,["whats","your"],"vector","victor"])});test("compose",function(){var a=function(d){return"hi: "+d};var c=function(d){return d+"!"};var b=_.compose(c,a);equal(b("moe"),"hi: moe!","can compose a function that takes another");b=_.compose(a,c);equal(b("moe"),"hi: moe!","in this case, the functions are also commutative")});test("after",function(){var a=function(c,b){var e=0;var d=_.after(c,function(){e++});while(b--){d()}return e};equal(a(5,5),1,"after(N) should fire after being called N times");equal(a(5,4),0,"after(N) should not fire unless called N times");equal(a(0,0),1,"after(0) should fire immediately")})});