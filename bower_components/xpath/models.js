xpathmodels={};xpathmodels.DEBUG_MODE=false;debuglog=function(){if(xpathmodels.DEBUG_MODE){console.log(arguments)}};(function(){var f=xpathmodels;var i=f.validateAxisName=function(m){for(var n in f.XPathAxisEnum){if(f.XPathAxisEnum.hasOwnProperty(n)&&f.XPathAxisEnum[n]===m){return f.XPathAxisEnum[n]}}throw m+" is not a valid axis name!"};var b=function(m){return m.toXPath()};f.XPathNumericLiteral=function(m){this.value=SchemeNumber(m);this.toString=function(){return"{num:"+this.value.toString()+"}"};this.toXPath=function(){var n=function(o){var p;if(o<1){p=parseInt(o.toString().split("e-")[1]);if(p){o*=Math.pow(10,p-1);o="0."+(new Array(p)).join("0")+o.toString().substring(2)}}else{p=parseInt(o.toString().split("+")[1]);if(p>20){p-=20;o/=Math.pow(10,p);o+=(new Array(p+1)).join("0")}}return o};return n(this.value.toString())};this.getChildren=function(){return[]};return this};f.XPathStringLiteral=function(m){this.value=m;var n=function(o){if(o.indexOf("'")!==-1){return'"'+o+'"'}else{return"'"+o+"'"}};this.valueDisplay=n(m);this.toString=function(){return"{str:"+this.valueDisplay+"}"};this.toXPath=function(){return this.valueDisplay};this.getChildren=function(){return[]};return this};f.XPathVariableReference=function(m){this.value=m;this.toString=function(){return"{var:"+String(this.value)+"}"};this.toXPath=function(){return"$"+String(this.value)};this.getChildren=function(){return[]}};f.XPathAxisEnum={CHILD:"child",DESCENDANT:"descendant",PARENT:"parent",ANCESTOR:"ancestor",FOLLOWING_SIBLING:"following-sibling",PRECEDING_SIBLING:"preceding-sibling",FOLLOWING:"following",PRECEDING:"preceding",ATTRIBUTE:"attribute",NAMESPACE:"namespace",SELF:"self",DESCENDANT_OR_SELF:"descendant-or-self",ANCESTOR_OR_SELF:"ancestor-or-self"};f.XPathTestEnum={NAME:"name",NAME_WILDCARD:"*",NAMESPACE_WILDCARD:":*",TYPE_NODE:"node()",TYPE_TEXT:"text()",TYPE_COMMENT:"comment()",TYPE_PROCESSING_INSTRUCTION:"processing-instruction"};f.XPathStep=function(m){this.axis=m.axis;this.test=m.test;this.predicates=m.predicates||[];this.name=m.name;this.namespace=m.namespace;this.literal=m.literal;this.testString=function(){switch(this.test){case f.XPathTestEnum.NAME:return String(this.name);case f.XPathTestEnum.TYPE_PROCESSING_INSTRUCTION:return"processing-instruction("+(this.literal?"'"+this.literal+"'":"")+")";case f.XPathTestEnum.NAMESPACE_WILDCARD:return this.namespace+":*";default:return this.test||null}};this.toString=function(){var n=[];n.push("{step:");n.push(String(this.axis));n.push(",");n.push(this.testString());if(this.predicates.length>0){n.push(",{");n.push(this.predicates.join(","));n.push("}")}n.push("}");return n.join("")};this.mainXPath=function(){var n=this.axis+"::";switch(this.axis){case f.XPathAxisEnum.DESCENDANT_OR_SELF:if(this.test===f.XPathTestEnum.TYPE_NODE){return"//"}break;case f.XPathAxisEnum.CHILD:n="";break;case f.XPathAxisEnum.ATTRIBUTE:n="@";break;case f.XPathAxisEnum.SELF:if(this.test===f.XPathTestEnum.TYPE_NODE){return"."}break;case f.XPathAxisEnum.PARENT:if(this.test===f.XPathTestEnum.TYPE_NODE){return".."}break;default:break}return n+this.testString()};this.predicateXPath=function(){if(this.predicates.length>0){return"["+this.predicates.map(b).join("][")+"]"}return""};this.toXPath=function(){return this.mainXPath()+this.predicateXPath()};this.getChildren=function(){return[]};return this};f.XPathInitialContextEnum={ROOT:"abs",RELATIVE:"rel",EXPR:"expr"};f.XPathPathExpr=function(n){var m=this;this.initial_context=n.initial_context;this.steps=n.steps||[];this.filter=n.filter;this.toString=function(){var p=[];p.push("{path-expr:");p.push(this.initial_context===f.XPathInitialContextEnum.EXPR?String(this.filter):this.initial_context);p.push(",{");p.push(this.steps.join(","));p.push("}}");return p.join("")};var o=function(u){var v=m.steps.map(u),s=[],q,w,r;var p=(m.initial_context===f.XPathInitialContextEnum.ROOT)?"/":"";if(m.filter){v.splice(0,0,u(m.filter))}if(v.length===0){return p}for(var t=0;t<v.length;t++){q=v[t];if(q!=="//"&&w!=="//"){r=(t===0)?p:"/";s.push(r)}s.push(q);w=q}return s.join("")};this.toXPath=function(){return o(b)};this.pathWithoutPredicates=function(){return o(function(p){return p.mainXPath()})};this.getChildren=function(){return this.steps};return this};f.XPathFuncExpr=function(m){this.id=m.id;this.args=m.args||[];this.toString=function(){var n=[];n.push("{func-expr:",String(this.id),",{");n.push(this.args.join(","));n.push("}}");return n.join("")};this.toXPath=function(){return this.id+"("+this.args.map(b).join(", ")+")"};this.getChildren=function(){return this.args};return this};f.XPathFilterExpr=function(m){this.expr=m.expr;this.predicates=m.predicates||[];this.toString=function(){var n=[];n.push("{filt-expr:",this.expr.toString(),",{");n.push(this.predicates.join(","));n.push("}}");return n.join("")};this.toXPath=function(){var n="";if(this.predicates.length>0){n="["+this.predicates.map(b).join("][")+"]"}var o=b(this.expr);if(!(this.expr instanceof f.XPathFuncExpr)){o="("+o+")"}return o+n};this.getChildren=function(){return this.predicates};return this};f.XPathExpressionTypeEnum={AND:"and",OR:"or",EQ:"==",NEQ:"!=",LT:"<",LTE:"<=",GT:">",GTE:">=",PLUS:"+",MINUS:"-",MULT:"*",DIV:"/",MOD:"%",UMINUS:"num-neg",UNION:"union"};var k=f.expressionTypeEnumToXPathLiteral=function(m){switch(m){case f.XPathExpressionTypeEnum.EQ:return"=";case f.XPathExpressionTypeEnum.MOD:return"mod";case f.XPathExpressionTypeEnum.DIV:return"div";case f.XPathExpressionTypeEnum.UMINUS:return"-";case f.XPathExpressionTypeEnum.UNION:return"|";default:return m}};var d=function(){return"{binop-expr:"+this.type+","+String(this.left)+","+String(this.right)+"}"};var h=function(m){switch(m){case f.XPathExpressionTypeEnum.OR:case f.XPathExpressionTypeEnum.AND:return"right";case f.XPathExpressionTypeEnum.EQ:case f.XPathExpressionTypeEnum.NEQ:case f.XPathExpressionTypeEnum.LT:case f.XPathExpressionTypeEnum.LTE:case f.XPathExpressionTypeEnum.GT:case f.XPathExpressionTypeEnum.GTE:case f.XPathExpressionTypeEnum.PLUS:case f.XPathExpressionTypeEnum.MINUS:case f.XPathExpressionTypeEnum.MULT:case f.XPathExpressionTypeEnum.DIV:case f.XPathExpressionTypeEnum.MOD:case f.XPathExpressionTypeEnum.UNION:return"left";case f.XPathExpressionTypeEnum.UMINUS:return"nonassoc";default:throw ("No order for "+m)}};var e=function(m){switch(m){case f.XPathExpressionTypeEnum.OR:return 0;case f.XPathExpressionTypeEnum.AND:return 1;case f.XPathExpressionTypeEnum.EQ:case f.XPathExpressionTypeEnum.NEQ:return 2;case f.XPathExpressionTypeEnum.LT:case f.XPathExpressionTypeEnum.LTE:case f.XPathExpressionTypeEnum.GT:case f.XPathExpressionTypeEnum.GTE:return 3;case f.XPathExpressionTypeEnum.PLUS:case f.XPathExpressionTypeEnum.MINUS:return 4;case f.XPathExpressionTypeEnum.MULT:case f.XPathExpressionTypeEnum.DIV:case f.XPathExpressionTypeEnum.MOD:return 5;case f.XPathExpressionTypeEnum.UMINUS:return 6;case f.XPathExpressionTypeEnum.UNION:return 7;default:throw ("No precedence for "+m)}};var c=f.isOp=function(n){var m=n.toString();return m.indexOf("{binop-expr:")===0||m.indexOf("{unop-expr:")===0};var a=f.isLiteral=function(m){return(m instanceof f.XPathNumericLiteral||m instanceof f.XPathStringLiteral||m instanceof f.XPathPathExpr)};var l=f.isSimpleOp=function(m){return c(m)&&a(m.left)&&a(m.right)};var j=function(){var n=e(this.type),m,q,o=false,r=false,s,p;if(c(this.left)){m=e(this.left.type);o=(m>n)?false:(m!==n)?true:(h(this.type)==="right")}if(c(this.right)){q=e(this.right.type);r=(q>n)?false:(q!==n)?true:(h(this.type)==="left")}s=o?"("+this.left.toXPath()+")":this.left.toXPath();p=r?"("+this.right.toXPath()+")":this.right.toXPath();return s+" "+k(this.type)+" "+p};var g=function(){return[this.left,this.right]};f.XPathBoolExpr=function(m){this.type=m.type;this.left=m.left;this.right=m.right;this.toString=d;this.toXPath=j;this.getChildren=g;return this};f.XPathEqExpr=function(m){this.type=m.type;this.left=m.left;this.right=m.right;this.toString=d;this.toXPath=j;this.getChildren=g;return this};f.XPathCmpExpr=function(m){this.type=m.type;this.left=m.left;this.right=m.right;this.toString=d;this.toXPath=j;this.getChildren=g;return this};f.XPathArithExpr=function(m){this.type=m.type;this.left=m.left;this.right=m.right;this.toString=d;this.toXPath=j;this.getChildren=g;return this};f.XPathUnionExpr=function(m){this.type=m.type;this.left=m.left;this.right=m.right;this.toString=d;this.toXPath=j;this.getChildren=g;return this};f.XPathNumNegExpr=function(m){this.type=m.type;this.value=m.value;this.toString=function(){return"{unop-expr:"+this.type+","+String(this.value)+"}"};this.toXPath=function(){return"-"+this.value.toXPath()};this.getChildren=function(){return[this.value]};return this}}());