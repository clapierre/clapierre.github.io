define(["require","./normalize"],function(l,i){var n={};var g=!!process.platform.match(/^win/);var c=function(r){return g?r.replace(/\\/g,"/"):r};var k=c(l.toUrl("base_url")).split("/");k[k.length-1]="";var j=k.join("/");function h(r){if(typeof process!=="undefined"&&process.versions&&!!process.versions.node&&require.nodeRequire){try{var u=require.nodeRequire("csso")}catch(t){console.log('Compression module not installed. Use "npm install csso -g" to enable.');return r}try{var s=r.length;r=u.justDoIt(r);console.log("Compressed CSS output to "+Math.round(r.length/s*100)+"%.");return r}catch(t){console.log("Unable to compress css.\n"+t);return r}}console.log("Compression not supported outside of nodejs environments.");return r}function b(v,u){if(typeof process!=="undefined"&&process.versions&&!!process.versions.node&&require.nodeRequire){var r=require.nodeRequire("fs");r.writeFileSync(v,u,"utf8")}else{var t=new java.lang.String(u);var s=new java.io.BufferedWriter(new java.io.OutputStreamWriter(new java.io.FileOutputStream(v),"utf-8"));try{s.write(t,0,t.length());s.flush()}finally{s.close()}}}function o(r){return r.replace(/(["'\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r")}var e;var f;var m=require.nodeRequire("less");var q=require.nodeRequire("path");var a=[];var d={};n.normalize=function(s,r){if(s.substr(s.length-5,5)==".less"){s=s.substr(0,s.length-5)}return r(s)};var p=/^([^\:\/]+:\/)?\//;n.load=function(t,u,w,v){e=e||v;if(!f){f=q.resolve(e.dir||q.dirname(e.out),e.siteRoot||".")+"/";f=c(f)}if(t.match(p)){return w()}var s=c(u.toUrl(t+".less"));var r=v.less||{};r.paths=[j];r.filename=s;r.async=false;r.syncImport=true;var x=new m.Parser(r);x.parse('@import (multiple) "'+q.relative(j,s)+'";',function(A,y){if(A){console.log(A+" at "+q.relative(j,A.filename)+", line "+A.line);return w.error(A)}var z=y.toCSS(e.less);d[t]=i(z,s,f);w()},r)};var a=[];n.write=function(t,r,s){if(r.match(p)){return}a.push(d[r]);if(!global._requirejsCssData){global._requirejsCssData={usedBy:{less:true},css:""}}else{global._requirejsCssData.usedBy.less=true}s.asModule(t+"!"+r,"define(function(){})")};n.onLayerEnd=function(s,t){var r=a.join("");if(e.separateCSS){console.log("Writing CSS! file: "+t.name+"\n");var u=e.dir?q.resolve(e.dir,e.baseUrl,t.name+".css"):e.out.replace(/(\.js)?$/,".css");u=c(u);r=i(r,f,u);process.nextTick(function(){if(global._requirejsCssData){r=global._requirejsCssData.css=r+global._requirejsCssData.css;delete global._requirejsCssData.usedBy.less;if(Object.keys(global._requirejsCssData.usedBy).length===0){delete global._requirejsCssData}}b(u,h(r))})}else{if(r==""){return}s("(function(c){var d=document,a='appendChild',i='styleSheet',s=d.createElement('style');s.type='text/css';d.getElementsByTagName('head')[0][a](s);s[i]?s[i].cssText=c:s[a](d.createTextNode(c));})\n('"+o(h(r))+"');\n")}a=[]};return n});