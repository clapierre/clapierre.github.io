(function(a){a(function(c){var h,b,f,i,d;h=c("./when");b=c("./cancelable");f=c("./delay");i=c("./function");return function g(r,l,q,k){var s,n,t;n=false;s=b(h.defer(),function(){n=true});t=s.reject;q=q||function(){return false};if(typeof l!=="function"){l=(function(u){return function(){return f(u)}})(l)}function p(u){s.resolve(u)}function m(u){i.apply(l).then(o,t);if(u!==d){s.notify(u)}}function o(){if(n){return}h(r(),function(u){h(q(u),function(v){return v?p(u):m(u)},function(){m(u)})},t)}if(k){m()}else{o()}s.promise=e(s.promise);s.promise.cancel=s.cancel;return s.promise};function j(){}function e(l){j.prototype=l;var k=new j();j.prototype=null;return k}})})(typeof define==="function"&&define.amd?define:function(a){module.exports=a(require)});