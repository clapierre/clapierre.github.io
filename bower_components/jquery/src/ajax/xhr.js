define(["../core","../var/support","../ajax"],function(e,c){e.ajaxSettings.xhr=window.ActiveXObject!==undefined?function(){return !this.isLocal&&/^(get|post|head|put|delete|options)$/i.test(this.type)&&a()||f()}:a;var d=0,b={},g=e.ajaxSettings.xhr();if(window.attachEvent){window.attachEvent("onunload",function(){for(var h in b){b[h](undefined,true)}})}c.cors=!!g&&("withCredentials" in g);g=c.ajax=!!g;if(g){e.ajaxTransport(function(h){if(!h.crossDomain||c.cors){var i;return{send:function(m,j){var k,l=h.xhr(),n=++d;l.open(h.type,h.url,h.async,h.username,h.password);if(h.xhrFields){for(k in h.xhrFields){l[k]=h.xhrFields[k]}}if(h.mimeType&&l.overrideMimeType){l.overrideMimeType(h.mimeType)}if(!h.crossDomain&&!m["X-Requested-With"]){m["X-Requested-With"]="XMLHttpRequest"}for(k in m){if(m[k]!==undefined){l.setRequestHeader(k,m[k]+"")}}l.send((h.hasContent&&h.data)||null);i=function(q,p){var o,t,r;if(i&&(p||l.readyState===4)){delete b[n];i=undefined;l.onreadystatechange=e.noop;if(p){if(l.readyState!==4){l.abort()}}else{r={};o=l.status;if(typeof l.responseText==="string"){r.text=l.responseText}try{t=l.statusText}catch(s){t=""}if(!o&&h.isLocal&&!h.crossDomain){o=r.text?200:404}else{if(o===1223){o=204}}}}if(r){j(o,t,r,l.getAllResponseHeaders())}};if(!h.async){i()}else{if(l.readyState===4){setTimeout(i)}else{l.onreadystatechange=b[n]=i}}},abort:function(){if(i){i(undefined,true)}}}}})}function a(){try{return new window.XMLHttpRequest()}catch(h){}}function f(){try{return new window.ActiveXObject("Microsoft.XMLHTTP")}catch(h){}}});