define(["./core","./deferred","./callbacks"],function(a){a.extend({queue:function(d,c,e){var b;if(d){c=(c||"fx")+"queue";b=a._data(d,c);if(e){if(!b||a.isArray(e)){b=a._data(d,c,a.makeArray(e))}else{b.push(e)}}return b||[]}},dequeue:function(g,f){f=f||"fx";var c=a.queue(g,f),h=c.length,e=c.shift(),b=a._queueHooks(g,f),d=function(){a.dequeue(g,f)};if(e==="inprogress"){e=c.shift();h--}if(e){if(f==="fx"){c.unshift("inprogress")}delete b.stop;e.call(g,d,b)}if(!h&&b){b.empty.fire()}},_queueHooks:function(d,c){var b=c+"queueHooks";return a._data(d,b)||a._data(d,b,{empty:a.Callbacks("once memory").add(function(){a._removeData(d,c+"queue");a._removeData(d,b)})})}});a.fn.extend({queue:function(b,c){var d=2;if(typeof b!=="string"){c=b;b="fx";d--}if(arguments.length<d){return a.queue(this[0],b)}return c===undefined?this:this.each(function(){var e=a.queue(this,b,c);a._queueHooks(this,b);if(b==="fx"&&e[0]!=="inprogress"){a.dequeue(this,b)}})},dequeue:function(b){return this.each(function(){a.dequeue(this,b)})},clearQueue:function(b){return this.queue(b||"fx",[])},promise:function(d,h){var c,e=1,j=a.Deferred(),g=this,b=this.length,f=function(){if(!(--e)){j.resolveWith(g,[g])}};if(typeof d!=="string"){h=d;d=undefined}d=d||"fx";while(b--){c=a._data(g[b],d+"queueHooks");if(c&&c.empty){e++;c.empty.add(f)}}f();return j.promise(h)}});return a});