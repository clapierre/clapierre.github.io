module.exports=rimraf;rimraf.sync=rimrafSync;var assert=require("assert");var path=require("path");var fs=require("fs");var glob=require("glob");var globOpts={nosort:true,nocomment:true,nonegate:true,silent:true};var timeout=0;var isWindows=(process.platform==="win32");function defaults(b){var a=["unlink","chmod","stat","lstat","rmdir","readdir"];a.forEach(function(c){b[c]=b[c]||fs[c];c=c+"Sync";b[c]=b[c]||fs[c]});b.maxBusyTries=b.maxBusyTries||3;b.emfileWait=b.emfileWait||1000;b.disableGlob=b.disableGlob||false}function rimraf(f,d,c){if(typeof d==="function"){c=d;d={}}assert(f,"rimraf: missing path");assert.equal(typeof f,"string","rimraf: path should be a string");assert(d,"rimraf: missing options");assert.equal(typeof d,"object","rimraf: options should be object");assert.equal(typeof c,"function","rimraf: callback function required");defaults(d);var b=0;var g=null;var h=0;if(d.disableGlob||!glob.hasMagic(f)){return a(null,[f])}fs.lstat(f,function(j,i){if(!j){return a(null,[f])}glob(f,globOpts,a)});function e(i){g=g||i;if(--h===0){c(g)}}function a(j,i){if(j){return c(j)}h=i.length;if(h===0){return c()}i.forEach(function(l){rimraf_(l,d,function k(n){if(n){if(isWindows&&(n.code==="EBUSY"||n.code==="ENOTEMPTY")&&b<d.maxBusyTries){b++;var m=b*100;return setTimeout(function(){rimraf_(l,d,k)},m)}if(n.code==="EMFILE"&&timeout<d.emfileWait){return setTimeout(function(){rimraf_(l,d,k)},timeout++)}if(n.code==="ENOENT"){n=null}}timeout=0;e(n)})})}}function rimraf_(c,b,a){assert(c);assert(b);assert(typeof a==="function");b.lstat(c,function(e,d){if(e&&e.code==="ENOENT"){return a(null)}if(d&&d.isDirectory()){return rmdir(c,b,e,a)}b.unlink(c,function(f){if(f){if(f.code==="ENOENT"){return a(null)}if(f.code==="EPERM"){return(isWindows)?fixWinEPERM(c,b,f,a):rmdir(c,b,f,a)}if(f.code==="EISDIR"){return rmdir(c,b,f,a)}}return a(f)})})}function fixWinEPERM(c,b,d,a){assert(c);assert(b);assert(typeof a==="function");if(d){assert(d instanceof Error)}b.chmod(c,666,function(e){if(e){a(e.code==="ENOENT"?null:d)}else{b.stat(c,function(f,g){if(f){a(f.code==="ENOENT"?null:d)}else{if(g.isDirectory()){rmdir(c,b,d,a)}else{b.unlink(c,a)}}})}})}function fixWinEPERMSync(e,b,f){assert(e);assert(b);if(f){assert(f instanceof Error)}try{b.chmodSync(e,666)}catch(d){if(d.code==="ENOENT"){return}else{throw f}}try{var c=b.statSync(e)}catch(a){if(a.code==="ENOENT"){return}else{throw f}}if(c.isDirectory()){rmdirSync(e,b,f)}else{b.unlinkSync(e)}}function rmdir(d,c,b,a){assert(d);assert(c);if(b){assert(b instanceof Error)}assert(typeof a==="function");c.rmdir(d,function(e){if(e&&(e.code==="ENOTEMPTY"||e.code==="EEXIST"||e.code==="EPERM")){rmkids(d,c,a)}else{if(e&&e.code==="ENOTDIR"){a(b)}else{a(e)}}})}function rmkids(c,b,a){assert(c);assert(b);assert(typeof a==="function");b.readdir(c,function(g,d){if(g){return a(g)}var f=d.length;if(f===0){return b.rmdir(c,a)}var e;d.forEach(function(h){rimraf(path.join(c,h),b,function(i){if(e){return}if(i){return a(e=i)}if(--f===0){b.rmdir(c,a)}})})})}function rimrafSync(e,b){b=b||{};defaults(b);assert(e,"rimraf: missing path");assert.equal(typeof e,"string","rimraf: path should be a string");assert(b,"rimraf: missing options");assert.equal(typeof b,"object","rimraf: options should be object");var d;if(b.disableGlob||!glob.hasMagic(e)){d=[e]}else{try{fs.lstatSync(e);d=[e]}catch(f){d=glob.sync(e,globOpts)}}if(!d.length){return}for(var c=0;c<d.length;c++){var e=d[c];try{var a=b.lstatSync(e)}catch(f){if(f.code==="ENOENT"){return}}try{if(a&&a.isDirectory()){rmdirSync(e,b,null)}else{b.unlinkSync(e)}}catch(f){if(f.code==="ENOENT"){return}if(f.code==="EPERM"){return isWindows?fixWinEPERMSync(e,b,f):rmdirSync(e,b,f)}if(f.code!=="EISDIR"){throw f}rmdirSync(e,b,f)}}}function rmdirSync(c,b,a){assert(c);assert(b);if(a){assert(a instanceof Error)}try{b.rmdirSync(c)}catch(d){if(d.code==="ENOENT"){return}if(d.code==="ENOTDIR"){throw a}if(d.code==="ENOTEMPTY"||d.code==="EEXIST"||d.code==="EPERM"){rmkidsSync(c,b)}}}function rmkidsSync(b,a){assert(b);assert(a);a.readdirSync(b).forEach(function(c){rimrafSync(path.join(b,c),a)});a.rmdirSync(b,a)};