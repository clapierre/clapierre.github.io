var fs=require("fs");var path=require("path");var Readable=require("stream").Readable;var util=require("util");var assign=require("../util/assign");function Walker(b,c,a){Readable.call(this,assign({objectMode:true},a));this.path=path.resolve(b);this.filter=c;this.pending=0;this.start()}util.inherits(Walker,Readable);Walker.prototype.start=function(){this.visit(this.path);return this};Walker.prototype.visit=function(b){this.pending++;var a=this;fs.lstat(b,function(d,c){if(d){a.emit("error",d,{path:b,stat:c});return a.finishItem()}if(a.filter&&!a.filter({path:b,stat:c})){return a.finishItem()}if(!c.isDirectory()){a.push({path:b,stat:c});return a.finishItem()}fs.readdir(b,function(f,e){if(f){a.emit("error",f,{path:b,stat:c});return a.finishItem()}a.push({path:b,stat:c});e.forEach(function(g){a.visit(path.join(b,g))});a.finishItem()})});return this};Walker.prototype.finishItem=function(){this.pending-=1;if(this.pending===0){this.push(null)}return this};Walker.prototype._read=function(){};module.exports=Walker;