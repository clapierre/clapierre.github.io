var test=require("tap").test;var CC=require("../index.js").ConfigChain;var env={foo_blaz:"blzaa",foo_env:"myenv"};var jsonObj={blaz:"json",json:true};var iniObj={"x.y.z":"xyz",blaz:"ini"};var fs=require("fs");var ini=require("ini");fs.writeFileSync("/tmp/config-chain-class.json",JSON.stringify(jsonObj));fs.writeFileSync("/tmp/config-chain-class.ini",ini.stringify(iniObj));var http=require("http");var reqs=0;http.createServer(function(b,a){if(++reqs===2){this.close()}if(b.url==="/json"){setTimeout(function(){a.setHeader("content-type","application/json");a.end(JSON.stringify({blaz:"http",http:true,json:true}))},200)}else{a.setHeader("content-type","application/ini");a.end(ini.stringify({blaz:"http",http:true,ini:true,json:false}))}}).listen(1337);test("basic class test",function(b){var c=new CC();var a=[{blaz:"json",json:true},{"x.y.z":"xyz",blaz:"ini"},{blaz:"blzaa",env:"myenv"},{blaz:"http",http:true,json:true},{blaz:"http",http:true,ini:true,json:false}];c.addFile("/tmp/config-chain-class.json").addFile("/tmp/config-chain-class.ini").addEnv("foo_",env).addUrl("http://localhost:1337/json").addUrl("http://localhost:1337/ini").on("load",function(){b.same(c.list,a);b.same(c.snapshot,{blaz:"json",json:true,"x.y.z":"xyz",env:"myenv",http:true,ini:true});c.del("blaz","/tmp/config-chain-class.json");b.same(c.snapshot,{blaz:"ini",json:true,"x.y.z":"xyz",env:"myenv",http:true,ini:true});c.del("blaz");b.same(c.snapshot,{json:true,"x.y.z":"xyz",env:"myenv",http:true,ini:true});c.shift();b.same(c.snapshot,{"x.y.z":"xyz",env:"myenv",http:true,json:true,ini:true});c.shift();b.same(c.snapshot,{env:"myenv",http:true,json:true,ini:true});c.shift();b.same(c.snapshot,{http:true,json:true,ini:true});c.shift();b.same(c.snapshot,{http:true,ini:true,json:false});c.shift();b.same(c.snapshot,{});b.end()})});