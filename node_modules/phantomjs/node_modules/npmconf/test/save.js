var test=require("tap").test;var npmconf=require("../npmconf.js");var common=require("./00-setup.js");var fs=require("fs");var ini=require("ini");var expectConf=["globalconfig = "+common.globalconfig,"email = i@izs.me","env-thing = asdf","init.author.name = Isaac Z. Schlueter","init.author.email = i@izs.me","init.author.url = http://blog.izs.me/","init.version = 1.2.3","proprietary-attribs = false","npm:publishtest = true","_npmjs.org:couch = https://admin:password@localhost:5984/registry","npm-www:nocache = 1","sign-git-tag = false","message = v%s","strict-ssl = false","_auth = dXNlcm5hbWU6cGFzc3dvcmQ=","","[_token]","AuthSession = yabba-dabba-doodle","version = 1","expires = 1345001053415","path = /","httponly = true",""].join("\n");var expectFile=["globalconfig = "+common.globalconfig,"email = i@izs.me","env-thing = asdf","init.author.name = Isaac Z. Schlueter","init.author.email = i@izs.me","init.author.url = http://blog.izs.me/","init.version = 1.2.3","proprietary-attribs = false","npm:publishtest = true","_npmjs.org:couch = https://admin:password@localhost:5984/registry","npm-www:nocache = 1","sign-git-tag = false","message = v%s","strict-ssl = false","_auth = dXNlcm5hbWU6cGFzc3dvcmQ=","","[_token]","AuthSession = yabba-dabba-doodle","version = 1","expires = 1345001053415","path = /","httponly = true",""].join("\n");test("saving configs",function(a){npmconf.load(function(d,b){if(d){throw d}b.set("sign-git-tag",false,"user");b.del("nodedir");b.del("tmp");var c=ini.stringify(b.sources.user.data);a.same(ini.parse(c),ini.parse(expectConf));fs.unlinkSync(common.userconfig);b.save("user",function(f){if(f){throw f}var e=fs.readFileSync(b.get("userconfig"),"utf8");a.same(ini.parse(e),ini.parse(expectFile));a.end()})})});test("setting prefix",function(a){npmconf.load(function(c,b){if(c){throw c}b.prefix="newvalue";a.same(b.prefix,"newvalue");a.end()})});