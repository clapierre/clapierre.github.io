/*!
 * node-progress
 * Copyright(c) 2011 TJ Holowaychuk <tj@vision-media.ca>
 * MIT Licensed
 */
exports=module.exports=ProgressBar;function ProgressBar(a,b){this.stream=b.stream||process.stderr;if(typeof(b)=="number"){var c=b;b={};b.total=c}else{b=b||{};if("string"!=typeof a){throw new Error("format required")}if("number"!=typeof b.total){throw new Error("total required")}}this.fmt=a;this.curr=0;this.total=b.total;this.width=b.width||this.total;this.clear=b.clear;this.chars={complete:b.complete||"=",incomplete:b.incomplete||"-"};this.callback=b.callback||function(){};this.lastDraw=""}ProgressBar.prototype.tick=function(a,b){if(a!==0){a=a||1}if("object"==typeof a){b=a,a=1}if(0==this.curr){this.start=new Date}this.curr+=a;this.render(b);if(this.curr>=this.total){this.complete=true;this.terminate();this.callback(this);return}};ProgressBar.prototype.render=function(h){if(!this.stream.isTTY){return}var f=this.curr/this.total;f=Math.min(Math.max(f,0),1);var e=f*100;var l,c,a;var k=new Date-this.start;var d=(e==100)?0:k*(this.total/this.curr-1);var g=this.fmt.replace(":current",this.curr).replace(":total",this.total).replace(":elapsed",isNaN(k)?"0.0":(k/1000).toFixed(1)).replace(":eta",(isNaN(d)||!isFinite(d))?"0.0":(d/1000).toFixed(1)).replace(":percent",e.toFixed(0)+"%");var i=Math.max(0,this.stream.columns-g.replace(":bar","").length);var b=Math.min(this.width,i);a=Math.round(b*f);c=Array(a+1).join(this.chars.complete);l=Array(b-a+1).join(this.chars.incomplete);g=g.replace(":bar",c+l);if(h){for(var j in h){g=g.replace(":"+j,h[j])}}if(this.lastDraw!==g){this.stream.clearLine();this.stream.cursorTo(0);this.stream.write(g);this.lastDraw=g}};ProgressBar.prototype.update=function(b,c){var a=Math.floor(b*this.total);var d=a-this.curr;this.tick(d,c)};ProgressBar.prototype.terminate=function(){if(this.clear){this.stream.clearLine();this.stream.cursorTo(0)}else{console.log()}};