var path=require("path"),Writer=require("../util/file-writer"),util=require("util"),Report=require("./index");function JsonReport(a){this.opts=a||{};this.opts.dir=this.opts.dir||process.cwd();this.opts.file=this.opts.file||this.getDefaultConfig().file;this.opts.writer=this.opts.writer||null}JsonReport.TYPE="json";util.inherits(JsonReport,Report);Report.mix(JsonReport,{synopsis:function(){return"prints the coverage object as JSON to a file"},getDefaultConfig:function(){return{file:"coverage-final.json"}},writeReport:function(e,b){var d=path.resolve(this.opts.dir,this.opts.file),c=this.opts.writer||new Writer(b),a=this;c.on("done",function(){a.emit("done")});c.writeFile(d,function(f){var g=true;f.println("{");e.files().forEach(function(h){if(g){g=false}else{f.println(",")}f.write(JSON.stringify(h));f.write(":");f.write(JSON.stringify(e.fileCoverageFor(h)))});f.println("}")});c.done()}});module.exports=JsonReport;