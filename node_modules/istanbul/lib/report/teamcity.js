var path=require("path"),util=require("util"),mkdirp=require("mkdirp"),fs=require("fs"),utils=require("../object-utils"),Report=require("./index");function TeamcityReport(a){Report.call(this);a=a||{};this.dir=a.dir||process.cwd();this.file=a.file}TeamcityReport.TYPE="teamcity";util.inherits(TeamcityReport,Report);function lineForKey(b,a){return"##teamcity[buildStatisticValue key='"+a+"' value='"+b+"']"}Report.mix(TeamcityReport,{synopsis:function(){return"report with system messages that can be interpreted with TeamCity"},getDefaultConfig:function(){return{file:null}},writeReport:function(d){var c=[],b,a=[],e;d.files().forEach(function(f){c.push(utils.summarizeFileCoverage(d.fileCoverageFor(f)))});b=utils.mergeSummaryObjects.apply(null,c);a.push("");a.push("##teamcity[blockOpened name='Code Coverage Summary']");a.push(lineForKey(b.statements.pct,"CodeCoverageB"));a.push(lineForKey(b.functions.covered,"CodeCoverageAbsMCovered"));a.push(lineForKey(b.functions.total,"CodeCoverageAbsMTotal"));a.push(lineForKey(b.functions.pct,"CodeCoverageM"));a.push(lineForKey(b.lines.covered,"CodeCoverageAbsLCovered"));a.push(lineForKey(b.lines.total,"CodeCoverageAbsLTotal"));a.push(lineForKey(b.lines.pct,"CodeCoverageL"));a.push("##teamcity[blockClosed name='Code Coverage Summary']");e=a.join("\n");if(this.file){mkdirp.sync(this.dir);fs.writeFileSync(path.join(this.dir,this.file),e,"utf8")}else{console.log(e)}this.emit("done")}});module.exports=TeamcityReport;