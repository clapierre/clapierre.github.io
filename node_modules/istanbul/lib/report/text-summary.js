var path=require("path"),util=require("util"),mkdirp=require("mkdirp"),defaults=require("./common/defaults"),fs=require("fs"),utils=require("../object-utils"),Report=require("./index");function TextSummaryReport(a){Report.call(this);a=a||{};this.dir=a.dir||process.cwd();this.file=a.file;this.watermarks=a.watermarks||defaults.watermarks()}TextSummaryReport.TYPE="text-summary";util.inherits(TextSummaryReport,Report);function lineForKey(e,f,b){var g=e[f],c,a,d=defaults.classFor(f,e,b);f=f.substring(0,1).toUpperCase()+f.substring(1);if(f.length<12){f+="                   ".substring(0,12-f.length)}a=[f,":",g.pct+"%","(",g.covered+"/"+g.total,")"].join(" ");c=g.skipped;if(c>0){a+=", "+c+" ignored"}return defaults.colorize(a,d)}Report.mix(TextSummaryReport,{synopsis:function(){return"text report that prints a coverage summary across all files, typically to console"},getDefaultConfig:function(){return{file:null}},writeReport:function(e){var d=[],c,b=[],a=this.watermarks,f;e.files().forEach(function(g){d.push(utils.summarizeFileCoverage(e.fileCoverageFor(g)))});c=utils.mergeSummaryObjects.apply(null,d);b.push("");b.push("=============================== Coverage summary ===============================");b.push.apply(b,[lineForKey(c,"statements",a),lineForKey(c,"branches",a),lineForKey(c,"functions",a),lineForKey(c,"lines",a)]);b.push("================================================================================");f=b.join("\n");if(this.file){mkdirp.sync(this.dir);fs.writeFileSync(path.join(this.dir,this.file),f,"utf8")}else{console.log(f)}this.emit("done")}});module.exports=TextSummaryReport;