var Report=require("./report"),configuration=require("./config"),inputError=require("./util/input-error");function Reporter(a,b){this.config=a||configuration.loadFile();this.dir=b||this.config.reporting.dir();this.reports={}}Reporter.prototype={add:function(a){if(this.reports[a]){return}var b=this.config,d=b.reporting.reportConfig()[a]||{};d.verbose=b.verbose;d.dir=this.dir;d.watermarks=b.reporting.watermarks();try{this.reports[a]=Report.create(a,d)}catch(c){throw inputError.create("Invalid report format ["+a+"]")}},addAll:function(a){var b=this;a.forEach(function(c){b.add(c)})},write:function(e,d,f){var b=this.reports,a=this.config.verbose,c=this.handleDone.bind(this,f);this.inProgress=Object.keys(b).length;Object.keys(b).forEach(function(h){var g=b[h];if(a){console.error("Write report: "+h)}g.on("done",c);g.writeReport(e,d)})},handleDone:function(a){this.inProgress-=1;if(this.inProgress===0){return a()}}};module.exports=Reporter;