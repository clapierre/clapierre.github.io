var util=require("util");var Q=require("q");var mout=require("mout");var path=require("path");var GitResolver=require("./GitResolver");var copy=require("../../util/copy");var cmd=require("../../util/cmd");function GitFsResolver(c,b,a){GitResolver.call(this,c,b,a);this._source=path.resolve(this._config.cwd,this._source)}util.inherits(GitFsResolver,GitResolver);mout.object.mixIn(GitFsResolver,GitResolver);GitFsResolver.prototype._checkout=function(){var a=this._resolution;this._logger.action("checkout",a.tag||a.branch||a.commit,{resolution:a,to:this._tempDir});return this._copy().then(cmd.bind(cmd,"git",["checkout","-f",a.tag||a.branch||a.commit],{cwd:this._tempDir})).then(cmd.bind(cmd,"git",["clean","-f","-d"],{cwd:this._tempDir}))};GitFsResolver.prototype._copy=function(){return copy.copyDir(this._source,this._tempDir)};GitFsResolver.refs=function(b){var a;a=this._cache.refs.get(b);if(a){return Q.resolve(a)}a=cmd("git",["show-ref","--tags","--heads"],{cwd:b}).spread(function(c){var d;d=c.toString().trim().replace(/[\t ]+/g," ").split(/[\r\n]+/);this._cache.refs.set(b,d);return d}.bind(this));this._cache.refs.set(b,a);return a};module.exports=GitFsResolver;