var util=require("util");var fs=require("graceful-fs");var path=require("path");var mout=require("mout");var Q=require("q");var junk=require("junk");var Resolver=require("./Resolver");var copy=require("../../util/copy");var extract=require("../../util/extract");var createError=require("../../util/createError");function FsResolver(c,b,a){Resolver.call(this,c,b,a);this._source=path.resolve(this._config.cwd,this._source);if(this._target!=="*"){throw createError("File system sources can't resolve targets","ENORESTARGET")}if(this._guessedName){this._name=this._name.substr(0,this._name.length-path.extname(this._name).length)}}util.inherits(FsResolver,Resolver);mout.object.mixIn(FsResolver,Resolver);FsResolver.isTargetable=function(){return false};FsResolver.prototype._resolve=function(){return this._copy().then(this._extract.bind(this)).then(this._rename.bind(this))};FsResolver.prototype._copy=function(){var a=this;return Q.nfcall(fs.stat,this._source).then(function(c){var e;var b;var d;a._sourceStat=c;b={mode:c.mode};if(c.isDirectory()){e=a._tempDir;d=a._readJson(a._source).then(function(f){b.ignore=f.ignore;return copy.copyDir(a._source,e,b)}).then(function(){return})}else{e=path.join(a._tempDir,path.basename(a._source));d=copy.copyFile(a._source,e,b).then(function(){return e})}a._logger.action("copy",a._source,{src:a._source,dst:e});return d})};FsResolver.prototype._extract=function(a){if(!a||!extract.canExtract(a)){return Q.resolve()}this._logger.action("extract",path.basename(this._source),{archive:a,to:this._tempDir});return extract(a,this._tempDir)};FsResolver.prototype._rename=function(){return Q.nfcall(fs.readdir,this._tempDir).then(function(c){var a;var d;var b;c=c.filter(junk.isnt);if(c.length===1&&!/^(bower|component)\.json$/.test(c[0])){a=c[0];this._singleFile="index"+path.extname(a);d=path.join(this._tempDir,a);b=path.join(this._tempDir,this._singleFile);return Q.nfcall(fs.rename,d,b)}}.bind(this))};FsResolver.prototype._savePkgMeta=function(a){if(this._singleFile){a.main=this._singleFile}return Resolver.prototype._savePkgMeta.call(this,a)};module.exports=FsResolver;