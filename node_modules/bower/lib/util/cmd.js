var cp=require("child_process");var path=require("path");var Q=require("q");var mout=require("mout");var which=require("which");var PThrottler=require("p-throttler");var createError=require("./createError");var throttler=new PThrottler(5);var winBatchExtensions;var winWhichCache;var isWin=process.platform==="win32";if(isWin){winBatchExtensions=[".bat",".cmd"];winWhichCache={}}function getWindowsCommand(c){var b;var d;if(mout.object.hasOwn(winWhichCache,c)){return winWhichCache[c]}try{b=which.sync(c)}catch(a){return winWhichCache[c]=c}d=path.extname(b).toLowerCase();if(winBatchExtensions.indexOf(d)===-1){return winWhichCache[c]=c}return winWhichCache[c]=b}function executeCmd(g,e,d){var f;var c="";var a="";var b=Q.defer();if(isWin){g=getWindowsCommand(g)}f=cp.spawn(g,e,d);f.stdout.on("data",function(h){h=h.toString();b.notify(h);a+=h});f.stderr.on("data",function(h){h=h.toString();b.notify(h);c+=h});f.on("error",function(h){return b.reject(h)});f.on("close",function(i){var j;var h;if(i){if(!Array.isArray(e)){e=[]}j=g;j+=e.length?" "+e.join(" "):"";h=createError('Failed to execute "'+j+'", exit code of #'+i,"ECMDERR",{details:c,exitCode:i});return b.reject(h)}return b.resolve([a,c])});return b.promise}function cmd(c,b,a){return throttler.enqueue(executeCmd.bind(null,c,b,a))}module.exports=cmd;