var fs=require("graceful-fs");var path=require("path");var Q=require("q");var mkdirp=require("mkdirp");var createError=require("./createError");var isWin=process.platform==="win32";function createLink(c,d,b){var a=path.dirname(d);return Q.nfcall(mkdirp,a).then(function(){return Q.nfcall(fs.stat,c).fail(function(e){if(e.code==="ENOENT"){throw createError("Failed to create link to "+path.basename(c),"ENOENT",{details:c+" does not exist or points to a non-existent file"})}throw e})}).then(function(e){b=b||(e.isDirectory()?"dir":"file");return Q.nfcall(fs.symlink,c,d,b).fail(function(f){if(!isWin||f.code!=="EPERM"){throw f}return Q.nfcall(fs.symlink,c,d,"junction").fail(function(g){throw createError("Unable to create link to "+path.basename(c),g.code,{details:g.message.trim()+"\n\nTry running this command in an elevated terminal (run as root/administrator)."})})})})}module.exports=createLink;