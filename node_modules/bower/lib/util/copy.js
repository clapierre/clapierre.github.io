var fstream=require("fstream");var fstreamIgnore=require("fstream-ignore");var fs=require("graceful-fs");var Q=require("q");function copy(a,c){var b;var d;a.filter=filterSymlinks;a.follow=false;if(a.type==="Directory"&&a.ignore){d=a.ignore;a=fstreamIgnore(a);a.addIgnoreRules(d)}else{a=fstream.Reader(a)}b=Q.defer();a.on("error",b.reject).pipe(fstream.Writer(c)).on("error",b.reject).on("close",b.resolve);return b.promise}function copyMode(a,b){return Q.nfcall(fs.stat,a).then(function(c){return Q.nfcall(fs.chmod,b,c.mode)})}function filterSymlinks(a){return a.type!=="SymbolicLink"}function parseOptions(a){a=a||{};if(a.mode!=null){a.copyMode=false}else{if(a.copyMode==null){a.copyMode=true}}return a}function copyFile(c,d,a){var b;a=parseOptions(a);b=copy({path:c,type:"File"},{path:d,mode:a.mode,type:"File"});if(a.copyMode){b=b.then(copyMode.bind(copyMode,c,d))}return b}function copyDir(c,d,a){var b;a=parseOptions(a);b=copy({path:c,type:"Directory",ignore:a.ignore},{path:d,mode:a.mode,type:"Directory"});if(a.copyMode){b=b.then(copyMode.bind(copyMode,c,d))}return b}module.exports.copyDir=copyDir;module.exports.copyFile=copyFile;