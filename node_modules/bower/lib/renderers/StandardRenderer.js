function StandardRenderer(e,t){this._sizes={id:13,label:20,sumup:5},this._colors={warn:chalk.yellow,error:chalk.red,conflict:chalk.magenta,debug:chalk.gray,"default":chalk.cyan},this._command=e,this._config=t,this._compact=-1===this.constructor._wideCommands.indexOf(e)?!0:process.stdout.columns<120;var r=function(e){"EPIPE"===e.code&&process.exit(0)};process.stdout.on("error",r),process.stderr.on("error",r)}var chalk=require("chalk"),path=require("path"),mout=require("mout"),archy=require("archy"),Q=require("q"),stringifyObject=require("stringify-object"),os=require("os"),pkg=require(path.join(__dirname,"../..","package.json")),template=require("../util/template");StandardRenderer.prototype.end=function(e){var t="_"+mout.string.camelCase(this._command);this[t]&&this[t](e)},StandardRenderer.prototype.error=function(e){var t,r;this._guessOrigin(e),e.id=e.code||"error",e.level="error",t=this._prefix(e)+" "+e.message.replace(/\r?\n/g," ").trim()+"\n",this._write(process.stderr,"bower "+t),e.details&&(t=chalk.yellow("\nAdditional error details:\n")+e.details.trim()+"\n",this._write(process.stderr,t)),(this._config.verbose||!e.code||e.errno)&&(r=e.fstream_stack||e.stack||"N/A",t=chalk.yellow("\nStack trace:\n"),t+=(Array.isArray(r)?r.join("\n"):r)+"\n",t+=chalk.yellow("\nConsole trace:\n"),this._write(process.stderr,t),console.trace(),this._write(process.stderr,chalk.yellow("\nSystem info:\n")),this._write(process.stderr,"Bower version: "+pkg.version+"\n"),this._write(process.stderr,"Node version: "+process.versions.node+"\n"),this._write(process.stderr,"OS: "+os.type()+" "+os.release()+" "+os.arch()+"\n"))},StandardRenderer.prototype.log=function(e){var t="_"+mout.string.camelCase(e.id)+"Log";this._guessOrigin(e),this[t]?this[t](e):this._genericLog(e)},StandardRenderer.prototype.prompt=function(e){var t;this._config.color||e.forEach(function(e){e.message=chalk.stripColor(e.message)}),t=Q.defer();var r=require("inquirer");return r.prompt(e,t.resolve),t.promise},StandardRenderer.prototype._help=function(e){var t,r,n=this;e.command?(r="std/help-"+e.command.replace(/\s+/g,"/")+".std",t=template.exists(r)?template.render(r,e):template.render("std/help-generic.std",e),n._write(process.stdout,t)):(t=template.render("std/help.std",e),n._write(process.stdout,t))},StandardRenderer.prototype._install=function(e){var t="";mout.object.forOwn(e,function(e){var r;mout.object.forOwn(e.dependencies,function(e){e.dependencies={}}),e.canonicalDir=path.relative(this._config.cwd,e.canonicalDir),e.root=!0,r=this._tree2archy(e),t+="\n"+archy(r)},this),t&&this._write(process.stdout,t)},StandardRenderer.prototype._update=function(e){this._install(e)},StandardRenderer.prototype._list=function(e){var t;e.pkgMeta?(e.root=!0,t=archy(this._tree2archy(e))):t=stringifyObject(e,{indent:"  "}).replace(/[{}]/g,"")+"\n",this._write(process.stdout,t)},StandardRenderer.prototype._search=function(e){var t=template.render("std/search-results.std",e);this._write(process.stdout,t)},StandardRenderer.prototype._info=function(e){var t="",r=e,n=!1;"object"==typeof e&&e.versions&&(r=e.latest,n=!0),null!=r&&(t+="\n"+this._highlightJson(r)+"\n"),n&&(t+="\n"+template.render("std/info.std",e)),this._write(process.stdout,t)},StandardRenderer.prototype._lookup=function(e){var t=template.render("std/lookup.std",e);this._write(process.stdout,t)},StandardRenderer.prototype._link=function(e){this._sizes.id=4,this.log({id:"link",level:"info",message:e.dst+" > "+e.src}),e.installed&&this._install(e.installed)},StandardRenderer.prototype._register=function(e){var t;e&&(t="\n"+template.render("std/register.std",e),this._write(process.stdout,t))},StandardRenderer.prototype._cacheList=function(e){e.forEach(function(e){var t=e.pkgMeta,r=t.version||t._target;this._write(process.stdout,t.name+"="+t._source+"#"+r+"\n")},this)},StandardRenderer.prototype._genericLog=function(e){var t,r;t="warn"===e.level?process.stderr:process.stdout,r=this._prefix(e)+" "+e.message+"\n",this._write(t,"bower "+r)},StandardRenderer.prototype._checkoutLog=function(e){this._compact&&(e.message=e.origin.split("#")[0]+"#"+e.message),this._genericLog(e)},StandardRenderer.prototype._progressLog=function(e){this._compact&&(e.message=e.origin+" "+e.message),this._genericLog(e)},StandardRenderer.prototype._extractLog=function(e){this._compact&&(e.message=e.origin+" "+e.message),this._genericLog(e)},StandardRenderer.prototype._incompatibleLog=function(e){var t,r;e.data.picks.forEach(function(e){e.dependants=e.dependants.map(function(e){var t=e.pkgMeta._release;return e.endpoint.name+(t?"#"+t:"")}).join(", ")}),r=e.data.suitable?"std/conflict-resolved.std":"std/conflict.std",t=template.render(r,e.data),this._write(process.stdout,"\n"),this._write(process.stdout,t),this._write(process.stdout,"\n")},StandardRenderer.prototype._solvedLog=function(e){this._incompatibleLog(e)},StandardRenderer.prototype._jsonLog=function(e){this._write(process.stdout,"\n"+this._highlightJson(e.data.json)+"\n\n")},StandardRenderer.prototype._cachedEntryLog=function(e){this._compact&&(e.message=e.origin),this._genericLog(e)},StandardRenderer.prototype._guessOrigin=function(e){var t=e.data;t&&(t.endpoint?(e.origin=t.endpoint.name||t.registry&&t.endpoint.source,!e.origin&&t.resolver&&(e.origin=t.resolver.name),e.origin&&t.endpoint.target&&(e.origin+="#"+t.endpoint.target)):t.name&&(e.origin=t.name,t.version&&(e.origin+="#"+t.version)))},StandardRenderer.prototype._prefix=function(e){var t,r,n,s=this.constructor._idMappings[e.id]||e.id,i=this._colors[e.level]||this._colors["default"];return this._compact?(s.length>this._sizes.id&&(this._sizes.id=s.length+=this._sizes.sumup),i(mout.string.rpad(s,this._sizes.id))):(t=e.origin||"",r=s.length+t.length+1,n=this._sizes.id+this._sizes.label-r,1>n&&(this._sizes.label=t.length+this._sizes.sumup,n=this._sizes.id+this._sizes.label-r),chalk.green(t)+mout.string.repeat(" ",n)+i(s))},StandardRenderer.prototype._write=function(e,t){this._config.color||(t=chalk.stripColor(t)),e.write(t)},StandardRenderer.prototype._highlightJson=function(e){var t=require("cardinal");return t.highlight(stringifyObject(e,{indent:"  "}),{theme:{String:{_default:function(e){return chalk.cyan(e)}},Identifier:{_default:function(e){return chalk.green(e)}}},json:!0})},StandardRenderer.prototype._tree2archy=function(e){var t,r=mout.object.values(e.dependencies),n=e.missing?null:e.pkgMeta._release||e.pkgMeta.version,s=e.endpoint.name+(n?"#"+n:"");return e.root&&(s+=" "+e.canonicalDir),e.missing?s+=chalk.red(" not installed"):(e.different&&(s+=chalk.red(" different")),e.linked&&(s+=chalk.magenta(" linked")),e.incompatible?s+=chalk.yellow(" incompatible")+" with "+e.endpoint.target:e.extraneous&&(s+=chalk.green(" extraneous")),e.update&&(t="",e.update.target&&e.pkgMeta.version!==e.update.target&&(t+=e.update.target+" available"),e.update.latest!==e.update.target&&(t+=t?", ":"",t+="latest is "+e.update.latest),t&&(s+=" ("+chalk.cyan(t)+")")),r.length?{label:s,nodes:mout.object.values(r).map(this._tree2archy,this)}:s)},StandardRenderer._wideCommands=["install","update","link","info","home","register"],StandardRenderer._idMappings={mutual:"conflict","cached-entry":"cached"},module.exports=StandardRenderer;
