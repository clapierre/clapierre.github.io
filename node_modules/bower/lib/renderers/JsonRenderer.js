function JsonRenderer(){this._nrLogs=0}var chalk=require("chalk"),Q=require("q"),promptly=require("promptly"),createError=require("../util/createError");JsonRenderer.prototype.end=function(r){this._nrLogs&&process.stderr.write("]\n"),r&&process.stdout.write(this._stringify(r)+"\n")},JsonRenderer.prototype.error=function(r){var e,t=r.message;r.id=r.code||"error",r.level="error",r.data=r.data||{},delete r.message,r.message=t,e=r.fstream_stack||r.stack||"N/A",r.stacktrace=Array.isArray(e)?e.join("\n"):e,this.log(r),this.end()},JsonRenderer.prototype.log=function(r){process.stderr.write(this._nrLogs?", ":"["),process.stderr.write(this._stringify(r)),this._nrLogs++},JsonRenderer.prototype.prompt=function(r){var e=Q.resolve(),t={},n=this;return r.forEach(function(r){var o,s;switch(r.message=chalk.stripColor(r.message),o={silent:!0,trim:!1,"default":null==r["default"]?"":r["default"],validator:r.validate?function(e){var t=r.validate(e);if("string"==typeof t)throw t;return e}:null},r.type){case"input":s="prompt";break;case"confirm":case"password":s=r.type;break;case"checkbox":s="prompt";break;default:return void(e=e.then(function(){throw createError("Unknown prompt type","ENOTSUP")}))}e=e.then(function(){return r.level="prompt",n.log(r),Q.nfcall(promptly[s],"",o).then(function(e){t[r.name]=e})}),"checkbox"===r.type&&(e=e.then(function(){t[r.name]=t[r.name].split(",")}))}),e.then(function(){return t})},JsonRenderer.prototype._stringify=function(r){var e=JSON.stringify(r,null,"  ");return e=chalk.stripColor(e)},module.exports=JsonRenderer;
