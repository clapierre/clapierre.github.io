var mout=require("mout");var Q=require("q");var Project=require("../core/Project");var cli=require("../util/cli");var Tracker=require("../util/analytics").Tracker;var defaultConfig=require("../config");function uninstall(c,e,b,a){var f;var d;b=b||{};a=defaultConfig(a);f=new Project(a,c);d=new Tracker(a);d.trackNames("uninstall",e);return f.getTree(b).spread(function(g,h){return f.uninstall(e,b).then(function(k){var j=Object.keys(k);var i=[];mout.object.forOwn(h,function(l){if(j.indexOf(l.endpoint.name)!==-1){i.push.apply(i,mout.object.keys(l.dependencies))}});return clean(f,i,k)})})}function clean(c,b,a){a=a||{};return c.getTree().spread(function(d,f){var e=[];var g={};mout.object.forOwn(f,function(h){if(b.indexOf(h.endpoint.name)!==-1){e.push(h)}});c.walkTree(d,function(h,i){if(b.indexOf(i)!==-1){g[i]=g[i]||0;g[i]+=h.nrDependants}},true);e=e.filter(function(h){return !g[h.endpoint.name]});if(!e.length){return Q.resolve(a)}b=e.map(function(h){return h.endpoint.name});return c.uninstall(b).then(function(i){var h;mout.object.mixIn(a,i);h=[];e.forEach(function(j){h.push.apply(h,mout.object.keys(j.dependencies))});return clean(c,h,a)})})}uninstall.line=function(c,a){var b=uninstall.options(a);var d=b.argv.remain.slice(1);if(!d.length){return new Q()}else{return uninstall(c,d,b)}};uninstall.options=function(a){return cli.readOptions({save:{type:Boolean,shorthand:"S"},"save-dev":{type:Boolean,shorthand:"D"}},a)};uninstall.completion=function(){};module.exports=uninstall;