var path=require("path");var rimraf=require("rimraf");var Q=require("q");var Project=require("../core/Project");var createLink=require("../util/createLink");var cli=require("../util/cli");var defaultConfig=require("../config");function link(c,b,a){if(b){return linkTo(c,b,a)}else{return linkSelf(c)}}function linkSelf(b,a){var c;a=defaultConfig(a);c=new Project(a,b);return c.getJson().then(function(d){var e=a.cwd;var f=path.join(a.storage.links,d.name);return Q.nfcall(rimraf,f).then(function(){return createLink(e,f)}).then(function(){return{src:e,dst:f}})})}function linkTo(d,c,a,b){var f;var g;var e;b=defaultConfig(b);e=new Project(b,d);a=a||c;f=path.join(b.storage.links,c);g=path.join(process.cwd(),b.directory,a);return Q.nfcall(rimraf,g).then(function(){return createLink(f,g)}).then(function(){return e.update([a])}).then(function(h){return{src:f,dst:g,installed:h}})}link.line=function(e,a){var d=cli.readOptions(a);var c=d.argv.remain[1];var b=d.argv.remain[2];return link(e,c,b)};link.completion=function(){};module.exports=link;