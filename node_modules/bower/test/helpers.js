var Q=require("q");var path=require("path");var mkdirp=require("mkdirp");var rimraf=require("rimraf");var uuid=require("node-uuid");var object=require("mout/object");var fs=require("fs");var glob=require("glob");var os=require("os");var cmd=require("../lib/util/cmd");var config=require("../lib/config");var env={GIT_AUTHOR_DATE:"Sun Apr 7 22:13:13 2013 +0000",GIT_AUTHOR_NAME:"André Cruz",GIT_AUTHOR_EMAIL:"amdfcruz@gmail.com",GIT_COMMITTER_DATE:"Sun Apr 7 22:13:13 2013 +0000",GIT_COMMITTER_NAME:"André Cruz",GIT_COMMITTER_EMAIL:"amdfcruz@gmail.com"};object.mixIn(env,process.env);var tmpLocation=path.join(os.tmpdir?os.tmpdir():os.tmpDir(),"bower-tests",uuid.v4().slice(0,8));exports.require=function(a){return require(path.join(__dirname,"../",a))};beforeEach(function(){config.reset()});after(function(){rimraf.sync(tmpLocation)});exports.TempDir=(function(){function a(b){this.path=path.join(tmpLocation,uuid.v4());this.defaults=b}a.prototype.create=function(c){var b=this;c=object.merge(c||{},this.defaults);if(c){object.forOwn(c,function(e,f){if(typeof e==="object"){e=JSON.stringify(e,null," ")+"\n"}var d=path.join(b.path,f);mkdirp.sync(path.dirname(d));fs.writeFileSync(d,e)})}return this};a.prototype.prepare=function(b){rimraf.sync(this.path);mkdirp.sync(this.path);this.create(b);return this};a.prototype.prepareGit=function(c){var b=this;c=object.merge(c||{},this.defaults);rimraf.sync(b.path);mkdirp.sync(b.path);var d=new Q();object.forOwn(c,function(f,e){d=d.then(function(){return b.git("init")}).then(function(){b.glob("./!(.git)").map(function(g){var h=path.join(b.path,g);rimraf.sync(h)});b.create(f)}).then(function(){return b.git("add","-A")}).then(function(){return b.git("commit",'-m"commit"')}).then(function(){return b.git("tag",e)})});return d};a.prototype.glob=function(b){return glob.sync(b,{cwd:this.path,dot:true})};a.prototype.read=function(b){return fs.readFileSync(path.join(this.path,b),"utf8")};a.prototype.git=function(){var b=Array.prototype.slice.call(arguments);return cmd("git",b,{cwd:this.path,env:env})};a.prototype.exists=function(b){return fs.existsSync(path.join(this.path,b))};return a})();exports.expectEvent=function(c,b){var a=Q.defer();c.once(b,function(){a.resolve(arguments)});return a.promise};