var path=require("path");var nock=require("nock");var fs=require("graceful-fs");var expect=require("expect.js");var Logger=require("bower-logger");var GitRemoteResolver=require("../../../lib/core/resolvers/GitRemoteResolver");var GitHubResolver=require("../../../lib/core/resolvers/GitHubResolver");var defaultConfig=require("../../../lib/config");describe("GitHub",function(){var a;var c=path.resolve(__dirname,"../../assets/package-a");before(function(){a=new Logger()});afterEach(function(){nock.cleanAll();a.removeAllListeners()});function b(d){if(typeof d==="string"){d={source:d}}return new GitHubResolver(d,defaultConfig({strictSsl:false}),a)}describe(".constructor",function(){it.skip("should throw an error on invalid GitHub URLs");it("should ensure .git in the source",function(){var d;d=b("git://github.com/twitter/bower");expect(d.getSource()).to.equal("git://github.com/twitter/bower.git");d=b("git://github.com/twitter/bower.git");expect(d.getSource()).to.equal("git://github.com/twitter/bower.git");d=b("git://github.com/twitter/bower.git/");expect(d.getSource()).to.equal("git://github.com/twitter/bower.git")})});describe(".resolve",function(){it("should download and extract the .tar.gz archive from GitHub.com",function(d){var e;nock("https://github.com").get("/IndigoUnited/events-emitter/archive/0.1.0.tar.gz").replyWithFile(200,path.resolve(__dirname,"../../assets/package-tar.tar.gz"));e=b({source:"git://github.com/IndigoUnited/events-emitter.git",target:"0.1.0"});e.resolve().then(function(f){expect(fs.existsSync(path.join(f,"foo.js"))).to.be(true);expect(fs.existsSync(path.join(f,".bower.json"))).to.be(true);expect(fs.existsSync(path.join(f,"bar.js"))).to.be(true);expect(fs.existsSync(path.join(f,"package-tar.tar.gz"))).to.be(false);expect(fs.existsSync(path.join(f,"package-tar.tar"))).to.be(false);d()}).done()});it("should retry using the GitRemoteResolver mechanism if download failed",function(e){var f;var d;nock("https://github.com").get("/IndigoUnited/events-emitter/archive/0.1.0.tar.gz").reply(200,"this is not a valid tar");a.on("log",function(g){if(g.level==="warn"&&g.id==="retry"){d=true}});f=b({source:"git://github.com/IndigoUnited/events-emitter.git",target:"0.1.0"});f._source="file://"+c;f.resolve().then(function(g){expect(d).to.be(true);expect(fs.existsSync(path.join(g,"foo"))).to.be(true);expect(fs.existsSync(path.join(g,"bar"))).to.be(true);expect(fs.existsSync(path.join(g,"baz"))).to.be(true);e()}).done()});it("should retry using the GitRemoteResolver mechanism if extraction failed",function(e){var f;var d;nock("https://github.com").get("/IndigoUnited/events-emitter/archive/0.1.0.tar.gz").reply(500);a.on("log",function(g){if(g.level==="warn"&&g.id==="retry"){d=true}});f=b({source:"git://github.com/IndigoUnited/events-emitter.git",target:"0.1.0"});f._source="file://"+c;f.resolve().then(function(g){expect(d).to.be(true);expect(fs.existsSync(path.join(g,"foo"))).to.be(true);expect(fs.existsSync(path.join(g,"bar"))).to.be(true);expect(fs.existsSync(path.join(g,"baz"))).to.be(true);e()}).done()});it("should fallback to the GitRemoteResolver mechanism if resolution is not a tag",function(e){var g=b({source:"git://github.com/foo/bar.git",target:"2af02ac6ddeaac1c2f4bead8d6287ce54269c039"});var d=GitRemoteResolver.prototype._checkout;var f;GitRemoteResolver.prototype._checkout=function(){f=true;return d.apply(this,arguments)};g._source="file://"+c;g.resolve().then(function(h){expect(fs.existsSync(path.join(h,"foo"))).to.be(true);expect(fs.existsSync(path.join(h,"bar"))).to.be(true);expect(fs.existsSync(path.join(h,"baz"))).to.be(true);expect(f).to.be(true);e()}).fin(function(){GitRemoteResolver.prototype._checkout=d}).done()});it.skip("it should error out if the status code is not within 200-299");it.skip("should report progress if it takes too long to download")});describe("._savePkgMeta",function(){it.skip("should guess the homepage if not already set")})});