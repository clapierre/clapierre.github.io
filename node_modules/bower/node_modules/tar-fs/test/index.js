var test=require("tape");var rimraf=require("rimraf");var tar=require("../index");var path=require("path");var fs=require("fs");var os=require("os");var win32=os.platform()==="win32";test("copy a -> copy/a",function(e){e.plan(5);var d=path.join(__dirname,"fixtures","a");var c=path.join(__dirname,"fixtures","copy","a");rimraf.sync(c);tar.pack(d).pipe(tar.extract(c)).on("finish",function(){var f=fs.readdirSync(c);e.same(f.length,1);e.same(f[0],"hello.txt");var a=path.join(c,f[0]);var b=path.join(d,f[0]);e.same(fs.readFileSync(a,"utf-8"),fs.readFileSync(b,"utf-8"));e.same(fs.statSync(a).mode,fs.statSync(b).mode);e.same(fs.statSync(a).mtime.getTime(),fs.statSync(b).mtime.getTime())})});test("copy b -> copy/b",function(e){e.plan(8);var d=path.join(__dirname,"fixtures","b");var c=path.join(__dirname,"fixtures","copy","b");rimraf.sync(c);tar.pack(d).pipe(tar.extract(c)).on("finish",function(){var h=fs.readdirSync(c);e.same(h.length,1);e.same(h[0],"a");var f=path.join(c,h[0]);var g=path.join(d,h[0]);e.same(fs.statSync(f).mode,fs.statSync(g).mode);e.same(fs.statSync(f).mtime.getTime(),fs.statSync(g).mtime.getTime());e.ok(fs.statSync(f).isDirectory());var a=path.join(f,"test.js");var b=path.join(g,"test.js");e.same(fs.readFileSync(a,"utf-8"),fs.readFileSync(b,"utf-8"));e.same(fs.statSync(a).mode,fs.statSync(b).mode);e.same(fs.statSync(a).mtime.getTime(),fs.statSync(b).mtime.getTime())})});test("symlink",function(e){if(win32){e.plan(1);e.ok(true);return}e.plan(5);var d=path.join(__dirname,"fixtures","c");rimraf.sync(path.join(d,"link"));fs.symlinkSync(".gitignore",path.join(d,"link"));var c=path.join(__dirname,"fixtures","copy","c");rimraf.sync(c);tar.pack(d).pipe(tar.extract(c)).on("finish",function(){var a=fs.readdirSync(c).sort();e.same(a.length,2);e.same(a[0],".gitignore");e.same(a[1],"link");var f=path.join(d,"link");var b=path.join(c,"link");e.same(fs.lstatSync(b).mtime.getTime(),fs.lstatSync(f).mtime.getTime());e.same(fs.readlinkSync(b),fs.readlinkSync(f))})});test("strip",function(e){e.plan(2);var d=path.join(__dirname,"fixtures","b");var c=path.join(__dirname,"fixtures","copy","b-strip");rimraf.sync(c);tar.pack(d).pipe(tar.extract(c,{strip:1})).on("finish",function(){var a=fs.readdirSync(c).sort();e.same(a.length,1);e.same(a[0],"test.js")})});test("strip + map",function(f){f.plan(2);var d=path.join(__dirname,"fixtures","b");var c=path.join(__dirname,"fixtures","copy","b-strip");rimraf.sync(c);var e=function(a){a.name=a.name.toUpperCase();return a};tar.pack(d).pipe(tar.extract(c,{strip:1,map:e})).on("finish",function(){var a=fs.readdirSync(c).sort();f.same(a.length,1);f.same(a[0],"TEST.JS")})});