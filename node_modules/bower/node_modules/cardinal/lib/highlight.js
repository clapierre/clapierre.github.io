var redeyed=require("redeyed"),theme=require("../themes/default"),colors=require("../colors"),colorSurround=colors.brightBlack.split(":");function trimEmptyLines(b){var a=b.pop();while(!a||!a.length){a=b.pop()}if(a){b.push(a)}}function addLinenos(j,e){var g=j.split("\n");trimEmptyLines(g);var a=g.length,k=[],h,b;function f(i){if(i<10){return 1}if(i<100){return 2}if(i<1000){return 3}if(i<10000){return 4}return 5}function c(m,i){var l=i-f(m);switch(l){case 0:return""+m;case 1:return" "+m;case 2:return"  "+m;case 3:return"   "+m;case 4:return"    "+m;case 5:return"     "+m}}h=f(a+e-1);for(var d=0;d<a;d++){b=[colorSurround[0],c(d+e,h),": ",colorSurround[1]].join("");k.push(b+g[d])}return k.join("\n")}module.exports=function highlight(d,c){c=c||{};if(c.json){d="!\n"+d}try{var a=redeyed(d,c.theme||theme),b=c.firstline&&!isNaN(c.firstline)?c.firstline:1;if(c.json){a.code=a.code.split("\n").slice(1).join("\n")}return c.linenos?addLinenos(a.code,b):a.code}catch(f){f.message="Unable to perform highlight. The code contained syntax errors: "+f.message;throw f}};