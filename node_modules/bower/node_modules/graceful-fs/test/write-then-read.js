var fs=require("../");var rimraf=require("rimraf");var mkdirp=require("mkdirp");var test=require("tap").test;var p=require("path").resolve(__dirname,"files");process.chdir(__dirname);process.stderr.write("");var num=4097;var paths=new Array(num);test("make files",function(b){rimraf.sync(p);mkdirp.sync(p);for(var a=0;a<num;++a){paths[a]="files/file-"+a;fs.writeFileSync(paths[a],"content")}b.end()});test("read files",function(c){var a=0;for(var b=0;b<num;++b){fs.readFile(paths[b],function(d,e){if(d){throw d}++a;if(a===num){c.pass("success");c.end()}})}});test("cleanup",function(a){rimraf.sync(p);a.end()});