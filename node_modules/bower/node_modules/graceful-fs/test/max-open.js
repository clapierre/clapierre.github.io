var test=require("tap").test;var fs=require("../");test("open lots of stuff",function(k){process.stderr.write("");var c=1024;var j=0;var g=[];var b=true;var d=false;var a=0;for(var h=0;h<c;h++){e()}function e(){j++;fs.open(__filename,"r",function(l,i){if(l){throw l}g.push(i);if(b){e()}})}setTimeout(function(){b=false;k.equal(j-g.length,c);f()},100);function f(){if(d){return}a++;if(g.length===0){console.error("done called %d times",a);k.ok(a>=2);return k.end()}d=true;setTimeout(function(){d=false;f()},100);var i=g.slice(0);g.length=0;i.forEach(function(l){fs.close(l,function(m){if(m){throw m}})})}});