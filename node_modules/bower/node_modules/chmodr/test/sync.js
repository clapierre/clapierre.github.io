var chmodr=require("../"),test=require("tap").test,mkdirp=require("mkdirp"),rimraf=require("rimraf"),fs=require("fs"),dirs=[];rimraf("/tmp/chmodr",function(d){if(d){throw d}var b=5;for(var a=0;a<5;a++){mkdirp(getDir(),c)}function c(e){if(e){throw e}if(--b===0){runTest()}}});function getDir(){var a=Math.floor(Math.random()*Math.pow(16,4)).toString(16);var d=Math.floor(Math.random()*Math.pow(16,4)).toString(16);var c=Math.floor(Math.random()*Math.pow(16,4)).toString(16);var b="/tmp/chmodr/"+[a,d,c].join("/");dirs.push(b);return b}function runTest(){test("should complete successfully",function(a){console.error("calling chmodr 0700");chmodr.sync("/tmp/chmodr",448);a.end()});dirs.forEach(function(a){test("verify "+a,function(b){fs.stat(a,function(d,c){if(d){b.ifError(d);return b.end()}b.equal(c.mode&511,448,"uid should be 0700");b.end()})})});test("cleanup",function(a){rimraf("/tmp/chmodr",function(b){a.ifError(b);a.end()})})};