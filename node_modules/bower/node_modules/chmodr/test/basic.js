var chmodr=require("../"),test=require("tap").test,mkdirp=require("mkdirp"),rimraf=require("rimraf"),fs=require("fs"),dirs=[];rimraf("/tmp/chmodr",function(d){if(d){throw d}var b=5;for(var a=0;a<5;a++){mkdirp(getDir(),c)}function c(e){if(e){throw e}if(--b===0){runTest()}}});function getDir(){var a="/tmp/chmodr";a+="/"+Math.floor(Math.random()*Math.pow(16,4)).toString(16);dirs.push(a);a+="/"+Math.floor(Math.random()*Math.pow(16,4)).toString(16);dirs.push(a);a+="/"+Math.floor(Math.random()*Math.pow(16,4)).toString(16);dirs.push(a);return a}function runTest(){test("should complete successfully",function(a){console.error("calling chmodr 0700");chmodr("/tmp/chmodr",448,function(b){a.ifError(b);a.end()})});dirs.forEach(function(a){test("verify "+a,function(b){fs.stat(a,function(d,c){if(d){b.ifError(d);return b.end()}b.equal(c.mode&511,448,"mode should be 0700");b.end()})})});test("cleanup",function(a){rimraf("/tmp/chmodr/",function(b){a.ifError(b);a.end()})})};