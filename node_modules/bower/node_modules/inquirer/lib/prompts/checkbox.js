function Prompt(){return Base.apply(this,arguments),this.opt.choices||this.throwParamError("choices"),_.isArray(this.opt["default"])&&this.opt.choices.forEach(function(t){this.opt["default"].indexOf(t.value)>=0&&(t.checked=!0)},this),this.firstRender=!0,this.pointer=0,this.opt.choices.setRender(renderChoices),this.opt["default"]=null,this}function renderChoices(t){var e="",i=0;return this.choices.forEach(function(s,o){if("separator"===s.type)return i++,void(e+=" "+s+"\n");if(s.disabled)i++,e+=" - "+s.name,e+=" ("+(_.isString(s.disabled)?s.disabled:"Disabled")+")";else{var r=o-i===t;e+=r?chalk.cyan(utils.getPointer()):" ",e+=utils.getCheckbox(s.checked,s.name)}e+="\n"}.bind(this)),e.replace(/\n$/,"")}var _=require("lodash"),util=require("util"),chalk=require("chalk"),Base=require("./base"),utils=require("../utils/utils"),observe=require("../utils/events");module.exports=Prompt,util.inherits(Prompt,Base),Prompt.prototype._run=function(t){this.done=t;var e=observe(this.rl),i=this.handleSubmitEvents(e.line);return i.success.forEach(this.onEnd.bind(this)),i.error.forEach(this.onError.bind(this)),e.normalizedUpKey.takeUntil(i.success).forEach(this.onUpKey.bind(this)),e.normalizedDownKey.takeUntil(i.success).forEach(this.onDownKey.bind(this)),e.numberKey.takeUntil(i.success).forEach(this.onNumberKey.bind(this)),e.spaceKey.takeUntil(i.success).forEach(this.onSpaceKey.bind(this)),this.render(),this.hideCursor(),this.rl.output.mute(),this},Prompt.prototype.render=function(){var t=this.getQuestion(),e="\n"+this.opt.choices.render(this.pointer);this.firstRender&&(t+="(Press <space> to select)"),t+="answered"===this.status?chalk.cyan(this.selection.join(", "))+"\n":e,this.firstRender=!1;var i=t.split(/\n/);return this.height=i.length,this.rl.setPrompt(_.last(i)),this.write(t),this},Prompt.prototype.onEnd=function(t){this.rl.output.unmute(),this.showCursor(),this.status="answered",this.down().clean(1).render(),this.done(t.value)},Prompt.prototype.onError=function(t){this.rl.output.unmute(),this.showCursor(),this.down().error(t.isValid).clean().render(),this.hideCursor(),this.rl.output.mute()},Prompt.prototype.getCurrentValue=function(){var t=this.opt.choices.where({checked:!0});return this.selection=_.pluck(t,"name"),_.pluck(t,"value")},Prompt.prototype.onKeypress=function(t,e){var i=["up","down","space","j","k"];if(!(e&&!_.contains(i,e.name)||(!e||"space"!==e.name&&"j"!==e.name&&"k"!==e.name||(t=void 0),t&&"123456789".indexOf(t)<0))){var s=this.opt.choices.realLength;this.rl.output.unmute();var o=Number(t);if(s>=o&&o>0&&(this.pointer=o-1,e={name:"space"}),e&&"space"===e.name){var r=this.opt.choices.getChoice(this.pointer).checked;this.opt.choices.getChoice(this.pointer).checked=!r}else!e||"up"!==e.name&&"k"!==e.name?!e||"down"!==e.name&&"j"!==e.name||(this.pointer<s-1?this.pointer++:this.pointer=0):this.pointer>0?this.pointer--:this.pointer=s-1;this.clean().render(),this.rl.output.mute()}},Prompt.prototype.handleKeypress=function(t){this.rl.output.unmute(),t(),this.clean().render(),this.rl.output.mute()},Prompt.prototype.onUpKey=function(){this.handleKeypress(function(){var t=this.opt.choices.realLength;this.pointer=this.pointer>0?this.pointer-1:t-1}.bind(this))},Prompt.prototype.onDownKey=function(){this.handleKeypress(function(){var t=this.opt.choices.realLength;this.pointer=this.pointer<t-1?this.pointer+1:0}.bind(this))},Prompt.prototype.onNumberKey=function(t){this.handleKeypress(function(){t<=this.opt.choices.realLength&&(this.pointer=t-1,this.toggleChoice(this.pointer))}.bind(this))},Prompt.prototype.onSpaceKey=function(){this.handleKeypress(function(){this.toggleChoice(this.pointer)}.bind(this))},Prompt.prototype.toggleChoice=function(t){var e=this.opt.choices.getChoice(t).checked;this.opt.choices.getChoice(t).checked=!e};
