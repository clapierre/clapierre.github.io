function Prompt(){Base.apply(this,arguments),this.opt.choices||this.throwParamError("choices"),this.opt.validChoices=this.opt.choices.filter(Separator.exclude),this.selected=0,this.rawDefault=0,this.opt.choices.setRender(renderChoices),_.extend(this.opt,{validate:function(e){return null!=this.opt.choices.getChoice(e)}.bind(this)});var e=this.opt["default"];return _.isNumber(e)&&e>=0&&e<this.opt.choices.realLength&&(this.selected=this.rawDefault=e),this.opt["default"]=null,this}function renderChoices(e){var t="",r=0;return this.choices.forEach(function(i,s){if(t+="\n  ","separator"===i.type)return r++,void(t+=" "+i);var o=s-r,h=o+1+") "+i.name;o===e&&(h=chalk.cyan(h)),t+=h}.bind(this)),t}var _=require("lodash"),util=require("util"),clc=require("cli-color"),chalk=require("chalk"),Base=require("./base"),Separator=require("../objects/separator"),observe=require("../utils/events");module.exports=Prompt,util.inherits(Prompt,Base),Prompt.prototype._run=function(e){this.done=e;var t=observe(this.rl),r=t.line.map(this.filterInput.bind(this)),i=this.handleSubmitEvents(r);return i.success.forEach(this.onEnd.bind(this)),i.error.forEach(this.onError.bind(this)),t.keypress.takeUntil(i.success).forEach(this.onKeypress.bind(this)),this.render(),this},Prompt.prototype.render=function(){var e=this.getQuestion(),t=this.opt.choices.render(this.selected);"answered"===this.status?e+=chalk.cyan(this.opt.choices.getChoice(this.selected).name)+"\n":(e+=t,e+="\n  Answer: ");var r=e.split(/\n/);return this.height=r.length,this.rl.setPrompt(_.last(r)),this.write(e),this},Prompt.prototype.filterInput=function(e){return null==e||""===e?this.rawDefault:e-1},Prompt.prototype.onEnd=function(e){this.status="answered",this.selected=e.value;var t=this.opt.choices.getChoice(this.selected);this.down().clean(2).render(),this.done(t.value)},Prompt.prototype.onError=function(){this.hasError=!0,this.error("Please enter a valid index").write(clc.bol(0,!0)).clean().render()},Prompt.prototype.onKeypress=function(){var e=this.rl.line.length?Number(this.rl.line)-1:0;this.selected=this.opt.choices.getChoice(e)?e:void 0,this.cacheCursorPos(),this.hasError?this.down().clean(1):this.clean(),this.render().write(this.rl.line).restoreCursorPos()};
