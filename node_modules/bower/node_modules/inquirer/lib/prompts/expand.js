function Prompt(){return Base.apply(this,arguments),this.opt.choices||this.throwParamError("choices"),this.validateChoices(this.opt.choices),this.opt.choices.push({key:"h",name:"Help, list all options",value:"help"}),this.opt.choices.setRender(renderChoice),this.opt["default"]=this.generateChoicesString(this.opt.choices,this.opt["default"]),this}function renderChoice(e){var t="";return this.choices.forEach(function(r){if(t+="\n  ","separator"===r.type)return void(t+=" "+r);var s=r.key+") "+r.name;e===r.key&&(s=chalk.cyan(s)),t+=s}.bind(this)),t}var _=require("lodash"),util=require("util"),chalk=require("chalk"),Base=require("./base"),Separator=require("../objects/separator"),observe=require("../utils/events");module.exports=Prompt,util.inherits(Prompt,Base),Prompt.prototype._run=function(e){this.done=e;var t=observe(this.rl);return this.lineObs=t.line.forEach(this.onSubmit.bind(this)),this.keypressObs=t.keypress.forEach(this.onKeypress.bind(this)),this.render(),this},Prompt.prototype.render=function(){var e=this.getQuestion();"answered"===this.status?e+=chalk.cyan(this.selected.name)+"\n":"expanded"===this.status&&(e+=this.opt.choices.render(this.selectedKey),e+="\n  Answer: ");var t=e.split(/\n/);return this.height=t.length,this.rl.setPrompt(_.last(t)),this.write(e),this},Prompt.prototype.getChoices=function(){var e="";return this.opt.choices.forEach(function(t){if(e+="\n  ","separator"===t.type)return void(e+=" "+t);var r=t.key+") "+t.name;this.selectedKey===t.key&&(r=chalk.cyan(r)),e+=r}.bind(this)),e},Prompt.prototype.onSubmit=function(e){(null==e||""===e)&&(e=this.rawDefault);var t=this.opt.choices.where({key:e.toLowerCase()})[0];return null!=t&&"h"===t.key?(this.selectedKey="",this.status="expanded",void this.down().clean(2).render()):null!=t?(this.status="answered",this.selected=t,this.down().clean(2).render(),this.lineObs.dispose(),this.keypressObs.dispose(),void this.done(this.selected.value)):void this.error("Please enter a valid command").clean().render()},Prompt.prototype.onKeypress=function(){this.selectedKey=this.rl.line.toLowerCase();var e=this.opt.choices.where({key:this.selectedKey})[0];this.cacheCursorPos(),"expanded"===this.status?this.clean().render():this.down().hint(e?e.name:"").clean().render(),this.write(this.rl.line).restoreCursorPos()},Prompt.prototype.validateChoices=function(e){var t,r=[],s={};if(e.filter(Separator.exclude).map(function(e){e.key&&1===e.key.length||(t=!0),s[e.key]&&r.push(e.key),s[e.key]=!0,e.key=String(e.key).toLowerCase()}),t)throw new Error("Format error: `key` param must be a single letter and is required.");if(s.h)throw new Error("Reserved key error: `key` param cannot be `h` - this value is reserved.");if(r.length)throw new Error("Duplicate key error: `key` param must be unique. Duplicates: "+_.uniq(r).join(", "))},Prompt.prototype.generateChoicesString=function(e,t){var r=0;_.isNumber(t)&&this.opt.choices.getChoice(t)&&(r=t);var s=this.opt.choices.pluck("key");return this.rawDefault=s[r],s[r]=String(s[r]).toUpperCase(),s.join("")};
