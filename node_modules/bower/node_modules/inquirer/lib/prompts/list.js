function Prompt(){Base.apply(this,arguments),this.opt.choices||this.throwParamError("choices"),this.firstRender=!0,this.selected=0;var t=this.opt["default"];return _.isNumber(t)&&t>=0&&t<this.opt.choices.realLength&&(this.selected=t),_.isString(t)&&(this.selected=this.opt.choices.pluck("value").indexOf(t)),this.opt.choices.setRender(listRender),this.opt["default"]=null,this}function listRender(t){var e="",i=0;return this.choices.forEach(function(s,r){if("separator"===s.type)return i++,void(e+="  "+s+"\n");var h=r-i===t,n=(h?utils.getPointer()+" ":"  ")+s.name;h&&(n=chalk.cyan(n)),e+=n+" \n"}.bind(this)),e.replace(/\n$/,"")}var _=require("lodash"),util=require("util"),chalk=require("chalk"),Base=require("./base"),utils=require("../utils/utils"),observe=require("../utils/events");module.exports=Prompt,util.inherits(Prompt,Base),Prompt.prototype._run=function(t){this.done=t;var e=observe(this.rl);return e.normalizedUpKey.takeUntil(e.line).forEach(this.onUpKey.bind(this)),e.normalizedDownKey.takeUntil(e.line).forEach(this.onDownKey.bind(this)),e.numberKey.takeUntil(e.line).forEach(this.onNumberKey.bind(this)),e.line.take(1).forEach(this.onSubmit.bind(this)),this.render(),this.hideCursor(),this.rl.output.mute(),this},Prompt.prototype.render=function(){var t=this.getQuestion(),e="\n"+this.opt.choices.render(this.selected);this.firstRender&&(t+=chalk.dim("(Use arrow keys)")),t+="answered"===this.status?chalk.cyan(this.opt.choices.getChoice(this.selected).name)+"\n":e,this.firstRender=!1;var i=t.split(/\n/);return this.height=i.length,this.rl.setPrompt(_.last(i)),this.write(t),this},Prompt.prototype.onSubmit=function(){var t=this.opt.choices.getChoice(this.selected);this.status="answered",this.rl.output.unmute(),this.clean().render(),this.showCursor(),this.done(t.value)},Prompt.prototype.handleKeypress=function(t){this.rl.output.unmute(),t(),this.clean().render(),this.rl.output.mute()},Prompt.prototype.onUpKey=function(){this.handleKeypress(function(){var t=this.opt.choices.realLength;this.selected=this.selected>0?this.selected-1:t-1}.bind(this))},Prompt.prototype.onDownKey=function(){this.handleKeypress(function(){var t=this.opt.choices.realLength;this.selected=this.selected<t-1?this.selected+1:0}.bind(this))},Prompt.prototype.onNumberKey=function(t){this.handleKeypress(function(){t<=this.opt.choices.realLength&&(this.selected=t-1)}.bind(this))};
