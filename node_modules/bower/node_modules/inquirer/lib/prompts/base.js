function Prompt(t,r,e){return _.assign(this,{height:0,status:"pending"}),this.opt=_.defaults(_.clone(t),{validate:function(){return!0},filter:function(t){return t},when:function(){return!0}}),this.opt.message||this.throwParamError("message"),this.opt.name||this.throwParamError("name"),_.isArray(this.opt.choices)&&(this.opt.choices=new Choices(this.opt.choices,e)),this.rl=r,this}var _=require("lodash"),clc=require("cli-color"),chalk=require("chalk"),readline=require("readline"),utils=require("../utils/utils"),Choices=require("../objects/choices"),tty=require("../utils/tty"),rx=require("rx");module.exports=Prompt,_.extend(Prompt.prototype,tty),Prompt.prototype.run=function(t){var r=this;return this._run(function(e){r.filter(e,t)}),this},Prompt.prototype._run=function(t){t()},Prompt.prototype.throwParamError=function(t){throw new Error("You must provide a `"+t+"` parameter")},Prompt.prototype.error=function(t){readline.moveCursor(this.rl.output,-clc.width,0),readline.clearLine(this.rl.output,0);var r=chalk.red(">> ")+(t||"Please enter a valid value");return this.write(r),this.up()},Prompt.prototype.hint=function(t){if(readline.moveCursor(this.rl.output,-clc.width,0),readline.clearLine(this.rl.output,0),t.length){var r=chalk.cyan(">> ")+t;this.write(r)}return this.up()},Prompt.prototype.validate=function(t,r){utils.runAsync(this.opt.validate,r,t)},Prompt.prototype.handleSubmitEvents=function(t){var r=this,e=this.opt,i=t.flatMap(function(t){return rx.Observable.create(function(i){utils.runAsync(e.validate,function(e){i.onNext({isValid:e,value:r.getCurrentValue(t)}),i.onCompleted()},r.getCurrentValue(t))})}).share(),o=i.filter(function(t){return t.isValid===!0}).take(1),n=i.filter(function(t){return t.isValid!==!0}).takeUntil(o);return{success:o,error:n}},Prompt.prototype.getCurrentValue=function(t){return t},Prompt.prototype.filter=function(t,r){utils.runAsync(this.opt.filter,r,t)},Prompt.prototype.prefix=function(t){return t||(t=""),chalk.green("?")+" "+t},Prompt.prototype.suffix=function(t){return t||(t=""),(t.length<1||/([a-z1-9])$/i.test(t)?t+":":t).trim()+" "},Prompt.prototype.getQuestion=function(){var t=_.compose(this.prefix,this.suffix)(chalk.bold(this.opt.message));return null!=this.opt["default"]&&"answered"!==this.status&&(t+=chalk.dim("("+this.opt["default"]+") ")),t};
