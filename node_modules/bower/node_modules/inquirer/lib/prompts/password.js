function Prompt(){return Base.apply(this,arguments)}var _=require("lodash"),util=require("util"),chalk=require("chalk"),Base=require("./base"),observe=require("../utils/events");module.exports=Prompt,util.inherits(Prompt,Base),Prompt.prototype._run=function(t){this.done=t;var e=observe(this.rl),r=e.line.map(this.filterInput.bind(this)),i=this.handleSubmitEvents(r);return i.success.forEach(this.onEnd.bind(this)),i.error.forEach(this.onError.bind(this)),e.keypress.takeUntil(i.success).forEach(this.onKeypress.bind(this)),this.render(),this.rl.output.mute(),this},Prompt.prototype.render=function(){var t=this.getQuestion(),e=t.split(/\n/);return this.height=e.length,this.rl.setPrompt(_.last(e)),this.write(t),this},Prompt.prototype.onSubmit=function(t){var e=t;if(!e)var e=null!=this.opt["default"]?this.opt["default"]:"";this.rl.output.unmute(),this.write("\n"),this.validate(e,function(t){if(t===!0){this.status="answered",this.clean(1).render();var r=new Array(e.toString().length+1).join("*");this.write(chalk.cyan(r)+"\n"),this.lineObs.dispose(),this.keypressObs.dispose(),this.done(e)}else this.error(t).clean().render(),this.rl.output.mute()}.bind(this))},Prompt.prototype.filterInput=function(t){return t?t:null!=this.opt["default"]?this.opt["default"]:""},Prompt.prototype.onEnd=function(t){this.rl.output.unmute(),this.write("\n"),this.status="answered",this.clean(1).render();var e=new Array(t.value.toString().length+1).join("*");this.write(chalk.cyan(e)+"\n"),this.done(t.value)},Prompt.prototype.onError=function(t){this.rl.output.unmute(),this.write("\n"),this.error(t.isValid).clean().render(),this.rl.output.mute()},Prompt.prototype.onKeypress=function(){this.rl.output.unmute(),this.cacheCursorPos().clean().render();var t=new Array(this.rl.line.length+1).join("*");this.write(t).restoreCursorPos(),this.rl.output.mute()};
