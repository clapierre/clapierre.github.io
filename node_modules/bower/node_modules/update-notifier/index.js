"use strict";var spawn=require("child_process").spawn;var path=require("path");var Configstore=require("configstore");var chalk=require("chalk");var semverDiff=require("semver-diff");var latestVersion=require("latest-version");var stringLength=require("string-length");function UpdateNotifier(a){this.options=a=a||{};if(!a.packageName||!a.packageVersion){throw new Error("packageName and packageVersion required")}this.packageName=a.packageName;this.packageVersion=a.packageVersion;this.updateCheckInterval=typeof a.updateCheckInterval==="number"?a.updateCheckInterval:1000*60*60*24;this.hasCallback=typeof a.callback==="function";this.callback=a.callback||function(){};if(!this.hasCallback){this.config=new Configstore("update-notifier-"+this.packageName,{optOut:false,lastUpdateCheck:Date.now()})}}UpdateNotifier.prototype.check=function(){if(this.hasCallback){return this.checkNpm(this.callback)}if(this.config.get("optOut")||"NO_UPDATE_NOTIFIER" in process.env){return}this.update=this.config.get("update");if(this.update){this.config.del("update")}if(Date.now()-this.config.get("lastUpdateCheck")<this.updateCheckInterval){return}spawn(process.execPath,[path.join(__dirname,"check.js"),JSON.stringify(this.options)],{detached:true,stdio:"ignore"}).unref()};UpdateNotifier.prototype.checkNpm=function(a){latestVersion(this.packageName,function(b,c){if(b){return a(b)}a(null,{latest:c,current:this.packageVersion,type:semverDiff(this.packageVersion,c)||"latest",name:this.packageName})}.bind(this))};UpdateNotifier.prototype.notify=function(a){if(!process.stdout.isTTY||!this.update){return this}a=a||{};a.defer=a.defer===undefined?true:false;var i=function(l,k){return Array(k+1).join(l)};var h=" Update available: "+chalk.green.bold(this.update.latest)+chalk.dim(" (current: "+this.update.current+")")+" ";var g=" Run "+chalk.blue("npm update -g "+this.packageName)+" to update. ";var c=Math.max(stringLength(h),stringLength(g));var d=c-stringLength(g);var f=chalk.yellow("┌"+i("─",c)+"┐");var b=chalk.yellow("└"+i("─",c)+"┘");var e=chalk.yellow("│");var j="\n\n"+f+"\n"+e+h+e+"\n"+e+g+i(" ",d)+e+"\n"+b+"\n";if(a.defer){process.on("exit",function(){console.error(j)})}else{console.error(j)}return this};module.exports=function(a){var b=new UpdateNotifier(a);b.check();return b};module.exports.UpdateNotifier=UpdateNotifier;