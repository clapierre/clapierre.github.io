var expect=require("expect.js");var lang=require("mout/lang");var object=require("mout/object");var endpointParser=require("../");describe("endpoint-parser",function(){describe(".decompose",function(){it("should decompose endpoints correctly",function(){var a={"jquery#~2.0.0":{name:"",source:"jquery",target:"~2.0.0"},"jquery#*":{name:"",source:"jquery",target:"*"},"jquery#latest":{name:"",source:"jquery",target:"*"},"jquery#3dc50c62fe2d2d01afc58e7ad42236a35acff4d8":{name:"",source:"jquery",target:"3dc50c62fe2d2d01afc58e7ad42236a35acff4d8"},"jquery#master":{name:"",source:"jquery",target:"master"},"backbone=backbone-amd#~1.0.0":{name:"backbone",source:"backbone-amd",target:"~1.0.0"},"backbone=backbone-amd#latest":{name:"backbone",source:"backbone-amd",target:"*"},"backbone=backbone-amd#*":{name:"backbone",source:"backbone-amd",target:"*"},"http://twitter.github.io/bootstrap/assets/bootstrap.zip":{name:"",source:"http://twitter.github.io/bootstrap/assets/bootstrap.zip",target:"*"},"bootstrap=http://twitter.github.io/bootstrap/assets/bootstrap.zip":{name:"bootstrap",source:"http://twitter.github.io/bootstrap/assets/bootstrap.zip",target:"*"},"bootstrap=http://twitter.github.io/bootstrap/assets/bootstrap.zip#latest":{name:"bootstrap",source:"http://twitter.github.io/bootstrap/assets/bootstrap.zip",target:"*"}};object.forOwn(a,function(b,c){expect(endpointParser.decompose(c)).to.eql(b)})});it("should trim sources and targets",function(){var a=endpointParser.decompose("foo= source # ~1.0.2 ");expect(a.source).to.equal("source");expect(a.target).to.equal("~1.0.2");a=endpointParser.decompose("foo= source # latest");expect(a.source).to.equal("source");expect(a.target).to.equal("*");a=endpointParser.decompose("foo= source # *");expect(a.source).to.equal("source");expect(a.target).to.equal("*")})});describe(".compose",function(){it("should compose endpoints correctly",function(){var a={"jquery#~2.0.0":{name:"",source:"jquery",target:"~2.0.0"},jquery:[{name:"",source:"jquery",target:"*"},{name:"",source:"jquery",target:"latest"},{name:"",source:"jquery",target:""}],"jquery#3dc50c62fe2d2d01afc58e7ad42236a35acff4d8":{name:"",source:"jquery",target:"3dc50c62fe2d2d01afc58e7ad42236a35acff4d8"},"jquery#master":{name:"",source:"jquery",target:"master"},"backbone=backbone-amd#~1.0.0":{name:"backbone",source:"backbone-amd",target:"~1.0.0"},"backbone=backbone-amd":[{name:"backbone",source:"backbone-amd",target:"*"},{name:"backbone",source:"backbone-amd",target:"*"},{name:"backbone",source:"backbone-amd",target:""}],"http://twitter.github.io/bootstrap/assets/bootstrap.zip":{name:"",source:"http://twitter.github.io/bootstrap/assets/bootstrap.zip",target:"*"},"bootstrap=http://twitter.github.io/bootstrap/assets/bootstrap.zip":{name:"bootstrap",source:"http://twitter.github.io/bootstrap/assets/bootstrap.zip",target:"*"}};object.forOwn(a,function(b,c){b=lang.toArray(b);b.forEach(function(d){expect(endpointParser.compose(d)).to.equal(c)})})});it("should trim values",function(){expect(endpointParser.compose({name:" foo ",source:" bar ",target:" ~1.0.2 "})).to.equal("foo=bar#~1.0.2");expect(endpointParser.compose({name:" foo ",source:" foo ",target:" ~1.0.2 "})).to.equal("foo=foo#~1.0.2");expect(endpointParser.compose({name:" foo ",source:" foo ",target:" * "})).to.equal("foo=foo");expect(endpointParser.compose({name:" foo ",source:" foo ",target:" * "})).to.equal("foo=foo");expect(endpointParser.compose({name:" ",source:" foo ",target:""})).to.equal("foo")})});describe(".json2decomposed",function(){var a=[{name:"jquery",source:"jquery",target:"~1.9.1"},{name:"foo",source:"foo",target:"*"},{name:"bar",source:"bar",target:"*"},{name:"baz",source:"baz",target:"~0.2.0"},{name:"backbone",source:"backbone-amd",target:"~1.0.0"},{name:"backbone2",source:"backbone=backbone-amd",target:"~1.0.0"},{name:"bootstrap",source:"http://twitter.github.io/bootstrap/assets/bootstrap",target:"*"},{name:"bootstrap2",source:"http://twitter.github.io/bootstrap/assets/bootstrap",target:"*"},{name:"ssh",source:"git@example.com",target:"*"},{name:"git",source:"git://example.com",target:"*"},{name:"path",source:"/foo",target:"*"},{name:"winpath",source:"c:\\foo",target:"*"}];it("should decompose json endpoints correctly",function(){var c={jquery:"~1.9.1",foo:"latest",bar:"*",baz:"#~0.2.0",backbone:"backbone-amd#~1.0.0",backbone2:"backbone=backbone-amd#~1.0.0",bootstrap:"http://twitter.github.io/bootstrap/assets/bootstrap",bootstrap2:"http://twitter.github.io/bootstrap/assets/bootstrap#*",ssh:"git@example.com",git:"git://example.com",path:"/foo",winpath:"c:\\foo"};var b=0;object.forOwn(c,function(e,d){expect(endpointParser.json2decomposed(d,e)).to.eql(a[b]);b+=1})});it("should trim values",function(){var c={" jquery ":" ~1.9.1 "," foo ":" latest "," bar ":" * "," baz ":"# ~0.2.0 "," backbone ":" backbone-amd#~1.0.0 "," backbone2 ":" backbone=backbone-amd # ~1.0.0 "," bootstrap ":" http://twitter.github.io/bootstrap/assets/bootstrap"," bootstrap2 ":" http://twitter.github.io/bootstrap/assets/bootstrap # *"," ssh ":" git@example.com "," git ":" git://example.com "," path ":" /foo "," winpath ":" c:\\foo "};var b=0;object.forOwn(c,function(e,d){expect(endpointParser.json2decomposed(d,e)).to.eql(a[b]);b+=1})});it("should error out if key is not specified",function(){try{endpointParser.json2decomposed(null);throw new Error("Should have failed")}catch(b){expect(b.code).to.equal("EINVEND");expect(b.message).to.contain("key must be specified")}try{endpointParser.json2decomposed("");throw new Error("Should have failed")}catch(b){expect(b.code).to.equal("EINVEND");expect(b.message).to.contain("key must be specified")}})});describe(".decomposed2json",function(){var a=[{jquery:"~1.9.1"},{foo:"*"},{bar:"*"},{baz:"*"},{jqueryx:"jquery#~1.9.1"},{jqueryy:"jquery-x#*"},{jqueryy:"jquery-x#*"},{backbone:"backbone-amd#~1.0.0"},{backbone:"backbone=backbone-amd#~1.0.0"},{bootstrap:"http://twitter.github.io/bootstrap/assets/bootstrap"},{bootstrap:"http://twitter.github.io/bootstrap/assets/bootstrap"},{ssh:"git@example.com"},{git:"git://example.com"},{ckeditor:"#full/4.3.3"}];it("should compose endpoints to json correctly",function(){var c=[{name:"jquery",source:"jquery",target:"~1.9.1"},{name:"foo",source:"foo",target:"latest"},{name:"bar",source:"bar",target:"*"},{name:"baz",source:"baz",target:""},{name:"jqueryx",source:"jquery",target:"~1.9.1"},{name:"jqueryy",source:"jquery-x",target:""},{name:"jqueryy",source:"jquery-x",target:"*"},{name:"backbone",source:"backbone-amd",target:"~1.0.0"},{name:"backbone",source:"backbone=backbone-amd",target:"~1.0.0"},{name:"bootstrap",source:"http://twitter.github.io/bootstrap/assets/bootstrap",target:""},{name:"bootstrap",source:"http://twitter.github.io/bootstrap/assets/bootstrap",target:"*"},{name:"ssh",source:"git@example.com",target:"*"},{name:"git",source:"git://example.com",target:"*"},{name:"ckeditor",source:"ckeditor",target:"full/4.3.3"}];var b=0;c.forEach(function(d){expect(endpointParser.decomposed2json(d)).to.eql(a[b]);b+=1})});it("should trim values",function(){var c=[{name:" jquery ",source:" jquery ",target:" ~1.9.1 "},{name:"foo",source:" foo",target:" latest "},{name:"bar",source:"bar ",target:" * "},{name:"baz ",source:"baz",target:" "},{name:" jqueryx ",source:" jquery ",target:" ~1.9.1 "},{name:" jqueryy ",source:" jquery-x ",target:" "},{name:" jqueryy ",source:" jquery-x ",target:" * "},{name:" backbone ",source:" backbone-amd ",target:" ~1.0.0 "},{name:" backbone ",source:" backbone=backbone-amd ",target:" ~1.0.0 "},{name:" bootstrap ",source:" http://twitter.github.io/bootstrap/assets/bootstrap ",target:" "},{name:" bootstrap ",source:" http://twitter.github.io/bootstrap/assets/bootstrap ",target:" * "},{name:" ssh ",source:" git@example.com ",target:" * "},{name:" git ",source:" git://example.com ",target:" * "}];var b=0;c.forEach(function(d){expect(endpointParser.decomposed2json(d)).to.eql(a[b]);b+=1})});it("should throw an error if name is empty",function(){try{endpointParser.decomposed2json({name:"",source:"jquery",target:"*"});throw new Error("Should have failed")}catch(b){expect(b.code).to.equal("EINVEND");expect(b.message).to.contain("must have a name")}try{endpointParser.decomposed2json({name:" ",source:"jquery",target:"*"});throw new Error("Should have failed")}catch(b){expect(b.code).to.equal("EINVEND");expect(b.message).to.contain("must have a name")}})})});