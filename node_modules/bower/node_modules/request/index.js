var extend=require("util")._extend,cookies=require("./lib/cookies"),copy=require("./lib/copy"),helpers=require("./lib/helpers"),isFunction=helpers.isFunction,constructObject=helpers.constructObject,filterForCallback=helpers.filterForCallback,constructOptionsFrom=helpers.constructOptionsFrom,paramsHaveRequestBody=helpers.paramsHaveRequestBody;function initParams(b,a,c){c=filterForCallback([a,c]);a=constructOptionsFrom(b,a);return constructObject().extend({callback:c}).extend({options:a}).extend({uri:a.uri}).done()}function request(b,a,d){if(typeof b==="undefined"){throw new Error("undefined is not a valid uri or options object.")}var c=initParams(b,a,d);a=c.options;a.callback=c.callback;a.uri=c.uri;return new request.Request(a)}function requester(a){if(typeof a.options._requester==="function"){return a.options._requester}return request}request.get=function(b,a,d){var c=initParams(b,a,d);c.options.method="GET";return requester(c)(c.uri||null,c.options,c.callback)};request.head=function(b,a,d){var c=initParams(b,a,d);c.options.method="HEAD";if(paramsHaveRequestBody(c)){throw new Error("HTTP HEAD requests MUST NOT include a request body.")}return requester(c)(c.uri||null,c.options,c.callback)};request.post=function(b,a,d){var c=initParams(b,a,d);c.options.method="POST";return requester(c)(c.uri||null,c.options,c.callback)};request.put=function(b,a,d){var c=initParams(b,a,d);c.options.method="PUT";return requester(c)(c.uri||null,c.options,c.callback)};request.patch=function(b,a,d){var c=initParams(b,a,d);c.options.method="PATCH";return requester(c)(c.uri||null,c.options,c.callback)};request.del=function(b,a,d){var c=initParams(b,a,d);c.options.method="DELETE";return requester(c)(c.uri||null,c.options,c.callback)};request.jar=function(){return cookies.jar()};request.cookie=function(a){return cookies.parse(a)};request.defaults=function(a,c){var b=function(f){var d=function(g){g=extend({},g);delete g.headers;return g};var e=function(h,g){return constructObject().extend(g.headers).extend(h.options.headers).done()};return function(h,g,j){var i=initParams(h,g,j);i.options=extend(i.options,d(a));if(a.headers){i.options.headers=e(i,a)}if(isFunction(c)){if(f===request){f=c}else{i.options._requester=c}}return f(i.options,i.callback)}};defaults=b(this);defaults.get=b(this.get);defaults.patch=b(this.patch);defaults.post=b(this.post);defaults.put=b(this.put);defaults.head=b(this.head);defaults.del=b(this.del);defaults.cookie=b(this.cookie);defaults.jar=this.jar;defaults.defaults=this.defaults;return defaults};request.forever=function(b,c){var a=constructObject();if(c){a.extend(c)}if(b){a.agentOptions=b}a.extend({forever:true});return request.defaults(a.done())};module.exports=request;request.Request=require("./request");request.debug=process.env.NODE_DEBUG&&/\brequest\b/.test(process.env.NODE_DEBUG);request.initParams=initParams;