/*!
 * Jade
 * Copyright(c) 2010 TJ Holowaychuk <tj@vision-media.ca>
 * MIT Licensed
 */
var Parser=require("./parser"),Lexer=require("./lexer"),Compiler=require("./compiler"),runtime=require("./runtime"),fs=require("fs");exports.version="0.26.3";exports.selfClosing=require("./self-closing");exports.doctypes=require("./doctypes");exports.filters=require("./filters");exports.utils=require("./utils");exports.Compiler=Compiler;exports.Parser=Parser;exports.Lexer=Lexer;exports.nodes=require("./nodes");exports.runtime=runtime;exports.cache={};function parse(e,a){try{var f=new Parser(e,a.filename,a);var b=new (a.compiler||Compiler)(f.parse(),a),d=b.compile();if(a.debug){console.error("\nCompiled Function:\n\n\033[90m%s\033[0m",d.replace(/^/gm,"  "))}return"var buf = [];\n"+(a.self?"var self = locals || {};\n"+d:"with (locals || {}) {\n"+d+"\n}\n")+'return buf.join("");'}catch(c){f=f.context();runtime.rethrow(c,f.filename,f.lexer.lineno)}}exports.compile=function(e,c){var c=c||{},a=c.client,b=c.filename?JSON.stringify(c.filename):"undefined",d;if(c.compileDebug!==false){d=["var __jade = [{ lineno: 1, filename: "+b+" }];","try {",parse(String(e),c),"} catch (err) {","  rethrow(err, __jade[0].filename, __jade[0].lineno);","}"].join("\n")}else{d=parse(String(e),c)}if(a){d="attrs = attrs || jade.attrs; escape = escape || jade.escape; rethrow = rethrow || jade.rethrow; merge = merge || jade.merge;\n"+d}d=new Function("locals, attrs, escape, rethrow, merge",d);if(a){return d}return function(f){return d(f,runtime.attrs,runtime.escape,runtime.rethrow,runtime.merge)}};exports.render=function(f,b,c){if("function"==typeof b){c=b,b={}}if(b.cache&&!b.filename){return c(new Error('the "filename" option is required for caching'))}try{var e=b.filename;var a=b.cache?exports.cache[e]||(exports.cache[e]=exports.compile(f,b)):exports.compile(f,b);c(null,a(b))}catch(d){c(d)}};exports.renderFile=function(e,a,c){var b=e+":string";if("function"==typeof a){c=a,a={}}try{a.filename=e;var f=a.cache?exports.cache[b]||(exports.cache[b]=fs.readFileSync(e,"utf8")):fs.readFileSync(e,"utf8");exports.render(f,a,c)}catch(d){c(d)}};exports.__express=exports.renderFile;