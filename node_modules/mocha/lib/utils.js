var fs=require("fs"),path=require("path"),basename=path.basename,exists=fs.existsSync||path.existsSync,glob=require("glob"),join=path.join,debug=require("debug")("mocha:watch");var ignore=["node_modules",".git"];exports.escape=function(a){return String(a).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")};exports.forEach=function(a,e,d){for(var c=0,b=a.length;c<b;c++){e.call(d,a[c],c)}};exports.isString=function(a){return"string"===typeof a};exports.map=function(b,f,e){var a=[];for(var d=0,c=b.length;d<c;d++){a.push(f.call(e,b[d],d,b))}return a};exports.indexOf=function(a,d,e){for(var c=e||0,b=a.length;c<b;c++){if(a[c]===d){return c}}return -1};exports.reduce=function(a,d,f){var e=f;for(var c=0,b=a.length;c<b;c++){e=d(e,a[c],c,a)}return e};exports.filter=function(a,e){var c=[];for(var d=0,b=a.length;d<b;d++){var f=a[d];if(e(f,d,a)){c.push(f)}}return c};exports.keys=Object.keys||function(d){var c=[],a=Object.prototype.hasOwnProperty;for(var b in d){if(a.call(d,b)){c.push(b)}}return c};exports.watch=function(c,b){var a={interval:100};c.forEach(function(d){debug("file %s",d);fs.watchFile(d,a,function(f,e){if(e.mtime<f.mtime){b(d)}})})};var isArray=Array.isArray||function(a){return"[object Array]"=={}.toString.call(a)};if(typeof Buffer!=="undefined"&&Buffer.prototype){Buffer.prototype.toJSON=Buffer.prototype.toJSON||function(){return Array.prototype.slice.call(this,0)}}function ignored(a){return !~ignore.indexOf(a)}exports.files=function(b,d,a){a=a||[];d=d||["js"];var c=new RegExp("\\.("+d.join("|")+")$");fs.readdirSync(b).filter(ignored).forEach(function(e){e=join(b,e);if(fs.statSync(e).isDirectory()){exports.files(e,d,a)}else{if(e.match(c)){a.push(e)}}});return a};exports.slug=function(a){return a.toLowerCase().replace(/ +/g,"-").replace(/[^-\w]/g,"")};exports.clean=function(d){d=d.replace(/\r\n?|[\n\u2028\u2029]/g,"\n").replace(/^\uFEFF/,"").replace(/^function *\(.*\)\s*{|\(.*\) *=> *{?/,"").replace(/\s+\}$/,"");var a=d.match(/^\n?( *)/)[1].length,b=d.match(/^\n?(\t*)/)[1].length,c=new RegExp("^\n?"+(b?"\t":" ")+"{"+(b?b:a)+"}","gm");d=d.replace(c,"");return exports.trim(d)};exports.trim=function(a){return a.replace(/^\s+|\s+$/g,"")};exports.parseQuery=function(a){return exports.reduce(a.replace("?","").split("&"),function(d,f){var c=f.indexOf("="),b=f.slice(0,c),e=f.slice(++c);d[b]=decodeURIComponent(e);return d},{})};function highlight(a){return a.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\/\/(.*)/gm,'<span class="comment">//$1</span>').replace(/('.*?')/gm,'<span class="string">$1</span>').replace(/(\d+\.\d+)/gm,'<span class="number">$1</span>').replace(/(\d+)/gm,'<span class="number">$1</span>').replace(/\bnew[ \t]+(\w+)/gm,'<span class="keyword">new</span> <span class="init">$1</span>').replace(/\b(function|new|throw|return|var|if|else)\b/gm,'<span class="keyword">$1</span>')}exports.highlightTags=function(b){var d=document.getElementById("mocha").getElementsByTagName(b);for(var c=0,a=d.length;c<a;++c){d[c].innerHTML=highlight(d[c].innerHTML)}};var emptyRepresentation=function emptyRepresentation(b,a){a=a||exports.type(b);switch(a){case"function":return"[Function]";case"object":return"{}";case"array":return"[]";default:return b.toString()}};exports.type=function type(a){if(typeof Buffer!=="undefined"&&Buffer.isBuffer(a)){return"buffer"}return Object.prototype.toString.call(a).replace(/^\[.+\s(.+?)\]$/,"$1").toLowerCase()};exports.stringify=function(c){var b=exports.type(c);if(!~exports.indexOf(["object","array","function"],b)){if(b!="buffer"){return jsonStringify(c)}var a=c.toJSON();return jsonStringify(a.data&&a.type?a.data:a,2).replace(/,(\n|$)/g,"$1")}for(var d in c){if(Object.prototype.hasOwnProperty.call(c,d)){return jsonStringify(exports.canonicalize(c),2).replace(/,(\n|$)/g,"$1")}}return emptyRepresentation(c,b)};function jsonStringify(d,h,g){if(typeof h=="undefined"){return k(d)}g=g||1;var a=h*g,j=isArray(d)?"[":"{",e=isArray(d)?"]":"}",c=d.length||exports.keys(d).length,b=function(i,l){return new Array(l).join(i)};function k(m){switch(exports.type(m)){case"null":case"undefined":m="["+m+"]";break;case"array":case"object":m=jsonStringify(m,h,g+1);break;case"boolean":case"regexp":case"number":m=m===0&&(1/m)===-Infinity?"-0":m.toString();break;case"date":var l=isNaN(m.getTime())?m.toString():m.toISOString();m="[Date: "+l+"]";break;case"buffer":var i=m.toJSON();i=i.data&&i.type?i.data:i;m="[Buffer: "+jsonStringify(i,2,g+1)+"]";break;default:m=(m=="[Function]"||m=="[Circular]")?m:JSON.stringify(m)}return m}for(var f in d){if(!d.hasOwnProperty(f)){continue}--c;j+="\n "+b(" ",a)+(isArray(d)?"":'"'+f+'": ')+k(d[f])+(c?",":"")}return j+(j.length!=1?"\n"+b(" ",--a)+e:e)}exports.isBuffer=function(a){return typeof Buffer!=="undefined"&&Buffer.isBuffer(a)};exports.canonicalize=function(e,a){var c,d=exports.type(e),f,b=function b(h,g){a.push(h);g();a.pop()};a=a||[];if(exports.indexOf(a,e)!==-1){return"[Circular]"}switch(d){case"undefined":case"buffer":case"null":c=e;break;case"array":b(e,function(){c=exports.map(e,function(g){return exports.canonicalize(g,a)})});break;case"function":for(f in e){c={};break}if(!c){c=emptyRepresentation(e,d);break}case"object":c=c||{};b(e,function(){exports.forEach(exports.keys(e).sort(),function(g){c[g]=exports.canonicalize(e[g],a)})});break;case"date":case"number":case"regexp":case"boolean":c=e;break;default:c=e.toString()}return c};exports.lookupFiles=function lookupFiles(g,e,b){var f=[];var d=new RegExp("\\.("+e.join("|")+")$");if(!exists(g)){if(exists(g+".js")){g+=".js"}else{f=glob.sync(g);if(!f.length){throw new Error("cannot resolve path (or pattern) '"+g+"'")}return f}}try{var c=fs.statSync(g);if(c.isFile()){return g}}catch(a){return}fs.readdirSync(g).forEach(function(i){i=join(g,i);try{var j=fs.statSync(i);if(j.isDirectory()){if(b){f=f.concat(lookupFiles(i,e,b))}return}}catch(h){return}if(!j.isFile()||!d.test(i)||basename(i)[0]==="."){return}f.push(i)});return f};exports.undefinedError=function(){return new Error("Caught undefined error, did you throw without specifying what?")};exports.getError=function(a){return a||exports.undefinedError()};exports.stackTraceFilter=function(){var c="/",e=typeof document==="undefined"?{node:true}:{browser:true},d=e.node?process.cwd()+c:location.href.replace(/\/[^\/]*$/,"/");function f(h){return(~h.indexOf("node_modules"))}function b(h){return(~h.indexOf("node_modules"+c+"mocha"))||(~h.indexOf("components"+c+"mochajs"))||(~h.indexOf("components"+c+"mocha"))}function a(h){return(~h.indexOf("node_modules"))||(~h.indexOf("components"))}function g(h){return(~h.indexOf("(timers.js:"))||(~h.indexOf("(events.js:"))||(~h.indexOf("(node.js:"))||(~h.indexOf("(module.js:"))||(~h.indexOf("GeneratorFunctionPrototype.next (native)"))||false}return function(h){h=h.split("\n");h=exports.reduce(h,function(j,i){if(e.node&&(f(i)||b(i)||g(i))){return j}if(e.browser&&(a(i))){return j}j.push(i.replace(d,""));return j},[]);return h.join("\n")}};