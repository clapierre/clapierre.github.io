var Base=require("./base");exports=module.exports=NyanCat;function NyanCat(k){Base.call(this,k);var m=this,h=this.stats,b=Base.window.width*0.75|0,e=this.rainbowColors=m.generateColors(),j=this.colorIndex=0,i=this.numberOfLines=4,l=this.trajectories=[[],[],[],[]],a=this.nyanCatWidth=11,d=this.trajectoryWidthMax=(b-a),f=this.scoreboardWidth=5,g=this.tick=0,c=0;k.on("start",function(){Base.cursor.hide();m.draw()});k.on("pending",function(n){m.draw()});k.on("pass",function(n){m.draw()});k.on("fail",function(o,n){m.draw()});k.on("end",function(){Base.cursor.show();for(var n=0;n<m.numberOfLines;n++){write("\n")}m.epilogue()})}NyanCat.prototype.draw=function(){this.appendRainbow();this.drawScoreboard();this.drawRainbow();this.drawNyanCat();this.tick=!this.tick};NyanCat.prototype.drawScoreboard=function(){var b=this.stats;function a(c,d){write(" ");write(Base.color(c,d));write("\n")}a("green",b.passes);a("fail",b.failures);a("pending",b.pending);write("\n");this.cursorUp(this.numberOfLines)};NyanCat.prototype.appendRainbow=function(){var d=this.tick?"_":"-";var a=this.rainbowify(d);for(var c=0;c<this.numberOfLines;c++){var b=this.trajectories[c];if(b.length>=this.trajectoryWidthMax){b.shift()}b.push(a)}};NyanCat.prototype.drawRainbow=function(){var a=this;this.trajectories.forEach(function(b,c){write("\u001b["+a.scoreboardWidth+"C");write(b.join(""));write("\n")});this.cursorUp(this.numberOfLines)};NyanCat.prototype.drawNyanCat=function(){var b=this;var a=this.scoreboardWidth+this.trajectories[0].length;var f="\u001b["+a+"C";var e="";write(f);write("_,------,");write("\n");write(f);e=b.tick?"  ":"   ";write("_|"+e+"/\\_/\\ ");write("\n");write(f);e=b.tick?"_":"__";var c=b.tick?"~":"^";var d;write(c+"|"+e+this.face()+" ");write("\n");write(f);e=b.tick?" ":"  ";write(e+'""  "" ');write("\n");this.cursorUp(this.numberOfLines)};NyanCat.prototype.face=function(){var a=this.stats;if(a.failures){return"( x .x)"}else{if(a.pending){return"( o .o)"}else{if(a.passes){return"( ^ .^)"}else{return"( - .-)"}}}};NyanCat.prototype.cursorUp=function(a){write("\u001b["+a+"A")};NyanCat.prototype.cursorDown=function(a){write("\u001b["+a+"B")};NyanCat.prototype.generateColors=function(){var c=[];for(var d=0;d<(6*7);d++){var h=Math.floor(Math.PI/3);var j=(d*(1/6));var f=Math.floor(3*Math.sin(j)+3);var e=Math.floor(3*Math.sin(j+2*h)+3);var a=Math.floor(3*Math.sin(j+4*h)+3);c.push(36*f+6*e+a+16)}return c};NyanCat.prototype.rainbowify=function(b){if(!Base.useColors){return b}var a=this.rainbowColors[this.colorIndex%this.rainbowColors.length];this.colorIndex+=1;return"\u001b[38;5;"+a+"m"+b+"\u001b[0m"};function write(a){process.stdout.write(a)}NyanCat.prototype.__proto__=Base.prototype;