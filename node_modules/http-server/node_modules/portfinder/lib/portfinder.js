var fs=require("fs"),net=require("net"),path=require("path"),async=require("async"),mkdirp=require("mkdirp").mkdirp;exports.basePort=8000;exports.basePath="/tmp/portfinder";exports.getPort=function(a,d){if(!d){d=a;a={}}a.port=a.port||exports.basePort;a.host=a.host||null;a.server=a.server||net.createServer(function(){});function c(){a.server.removeListener("error",b);a.server.close();d(null,a.port)}function b(e){a.server.removeListener("listening",c);if(e.code!=="EADDRINUSE"&&e.code!=="EACCES"){return d(e)}exports.getPort({port:exports.nextPort(a.port),host:a.host,server:a.server},d)}a.server.once("error",b);a.server.once("listening",c);a.server.listen(a.port,a.host)};exports.getPorts=function(c,b,d){if(!d){d=b;b={}}var a=null;async.timesSeries(c,function(f,e){if(a){b.port=exports.nextPort(a)}exports.getPort(b,function(h,g){if(h){e(h)}else{a=g;e(null,g)}})},d)};exports.getSocket=function(b,e){if(!e){e=b;b={}}b.mod=b.mod||493;b.path=b.path||exports.basePath+".sock";function a(){fs.stat(b.path,function(f){if(f){if(f.code=="ENOENT"){e(null,b.path)}else{e(f)}}else{b.path=exports.nextSocket(b.path);exports.getSocket(b,e)}})}function d(f){mkdirp(f,b.mod,function(g){if(g){return e(g)}b.exists=true;a()})}function c(){var f=path.dirname(b.path);fs.stat(f,function(h,g){if(h||!g.isDirectory()){return d(f)}b.exists=true;a()})}return b.exists?a():c()};exports.nextPort=function(a){return a+1};exports.nextSocket=function(e){var d=path.dirname(e),c=path.basename(e,".sock"),b=c.match(/^([a-zA-z]+)(\d*)$/i),a=parseInt(b[2]),f=b[1];if(isNaN(a)){a=0}a+=1;return path.join(d,f+a+".sock")};