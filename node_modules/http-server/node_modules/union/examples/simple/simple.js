var fs=require("fs"),path=require("path"),union=require("../../lib"),director=require("director"),favicon=require("./middleware/favicon");var router=new director.http.Router();var server=union.createServer({before:[favicon(path.join(__dirname,"favicon.png")),function(b,a){var c=router.dispatch(b,a);if(!c){a.emit("next")}}]});router.get("/foo",function(){this.res.writeHead(200,{"Content-Type":"text/plain"});this.res.end("hello world\n")});router.post("/foo",{stream:true},function(){var c=this.req,a=this.res,b;b=fs.createWriteStream(__dirname+"/"+Date.now()+"-foo.txt");c.pipe(b);b.on("close",function(){a.writeHead(200,{"Content-Type":"text/plain"});a.end("wrote to a stream!")})});router.get("/redirect",function(){this.res.redirect("http://www.google.com")});router.get("/custom_redirect",function(){this.res.redirect("/foo",301)});router.get("/async",function(){var a=this;process.nextTick(function(){a.req.on("end",function(){a.res.end()});a.req.buffer=false})});server.listen(9090);console.log("union with director running on 9090");