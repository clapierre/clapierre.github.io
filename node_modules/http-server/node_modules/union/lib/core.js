var http=require("http"),https=require("https"),fs=require("fs"),stream=require("stream"),HttpStream=require("./http-stream"),RoutingStream=require("./routing-stream");var core=exports;core.createServer=function(e){var b=Array.isArray(e.after),g;if(!e){throw new Error("options is required to create a server")}function d(j,i){var h=new RoutingStream({before:e.before,buffer:e.buffer,after:b&&e.after.map(function(k){return new k}),request:j,response:i,limit:e.limit,headers:e.headers});h.on("error",function(l){var k=e.onError||core.errorHandler;k(l,h,h.target,function(){h.target.emit("next")})});j.pipe(h)}if(e.https||e.spdy){if(e.https&&e.spdy){throw new Error("You shouldn't be using https and spdy simultaneously.")}var c,g,f=!e.spdy?"https":"spdy";c=e[f];if(!c.key||!c.cert){throw new Error("Both options."+f+".`key` and options."+f+".`cert` are required.")}g={key:fs.readFileSync(c.key),cert:fs.readFileSync(c.cert)};if(c.ca){c.ca=!Array.isArray(c.ca)?[c.ca]:c.ca;g.ca=c.ca.map(function(h){return fs.readFileSync(h)})}if(e.spdy){var a=require("spdy");return a.createServer(g,d)}return https.createServer(g,d)}return http.createServer(d)};core.errorHandler=function error(c,b,a){if(c){(this.res||a).writeHead(c.status||500,c.headers||{"Content-Type":"text/plain"});(this.res||a).end(c.message+"\n");return}(this.res||a).writeHead(404,{"Content-Type":"text/plain"});(this.res||a).end("Not Found\n")};