function stream_callback(e){return function(){var r=new union.ResponseStream;return r.once("pipe",function(r){return e?e(null,r):void 0}),r}}var assert=require("assert"),vows=require("vows"),request=require("request"),union=require("../");vows.describe("union/after").addBatch({"When using `union`":{"a union server with after middleware":{topic:function(){var e=this;union.createServer({after:[stream_callback(),stream_callback(e.callback)]}).listen(9e3,function(){request.get("http://localhost:9000")})},"should preserve the request until the last call":function(e){assert.equal(e.req.httpVersion,"1.1"),assert.equal(e.req.url,"/"),assert.equal(e.req.method,"GET")}}}})["export"](module);