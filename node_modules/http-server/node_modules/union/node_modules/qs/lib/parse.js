var Utils=require("./utils");var internals={delimiter:"&",depth:5,arrayLimit:20,parameterLimit:1000};internals.parseValues=function(f,k){var d={};var c=f.split(k.delimiter,k.parameterLimit===Infinity?undefined:k.parameterLimit);for(var e=0,h=c.length;e<h;++e){var a=c[e];var g=a.indexOf("]=")===-1?a.indexOf("="):a.indexOf("]=")+1;if(g===-1){d[Utils.decode(a)]=""}else{var j=Utils.decode(a.slice(0,g));var b=Utils.decode(a.slice(g+1));if(!d.hasOwnProperty(j)){d[j]=b}else{d[j]=[].concat(d[j]).concat(b)}}}return d};internals.parseObject=function(f,h,e){if(!f.length){return h}var a=f.shift();var g={};if(a==="[]"){g=[];g=g.concat(internals.parseObject(f,h,e))}else{var d=a[0]==="["&&a[a.length-1]==="]"?a.slice(1,a.length-1):a;var c=parseInt(d,10);var b=""+c;if(!isNaN(c)&&a!==d&&b===d&&c>=0&&c<=e.arrayLimit){g=[];g[c]=internals.parseObject(f,h,e)}else{g[d]=internals.parseObject(f,h,e)}}return g};internals.parseKeys=function(c,g,a){if(!c){return}var d=/^([^\[\]]*)/;var h=/(\[[^\[\]]*\])/g;var f=d.exec(c);if(Object.prototype.hasOwnProperty(f[1])){return}var e=[];if(f[1]){e.push(f[1])}var b=0;while((f=h.exec(c))!==null&&b<a.depth){++b;if(!Object.prototype.hasOwnProperty(f[1].replace(/\[|\]/g,""))){e.push(f[1])}}if(f){e.push("["+c.slice(f.index)+"]")}return internals.parseObject(e,g,a)};module.exports=function(d,j){if(d===""||d===null||typeof d==="undefined"){return{}}j=j||{};j.delimiter=typeof j.delimiter==="string"||Utils.isRegExp(j.delimiter)?j.delimiter:internals.delimiter;j.depth=typeof j.depth==="number"?j.depth:internals.depth;j.arrayLimit=typeof j.arrayLimit==="number"?j.arrayLimit:internals.arrayLimit;j.parameterLimit=typeof j.parameterLimit==="number"?j.parameterLimit:internals.parameterLimit;var e=typeof d==="string"?internals.parseValues(d,j):d;var b={};var h=Object.keys(e);for(var c=0,f=h.length;c<f;++c){var g=h[c];var a=internals.parseKeys(g,e[g],j);b=Utils.merge(b,a)}return Utils.compact(b)};