"use strict";var simpleMethods,simpleRequestHeaders,simpleResponseHeaders,toLowerCase,checkOriginMatch;Object.defineProperty(exports,"simpleMethods",{get:function(){return["GET","HEAD","POST"]}});simpleMethods=exports.simpleMethods;Object.defineProperty(exports,"simpleRequestHeaders",{get:function(){return["accept","accept-language","content-language","content-type"]}});simpleRequestHeaders=exports.simpleRequestHeaders;Object.defineProperty(exports,"simpleResponseHeaders",{get:function(){return["cache-control","content-language","content-type","expires","last-modified","pragma"]}});simpleResponseHeaders=exports.simpleResponseHeaders;toLowerCase=function(a){return a.map(function(b){return b.toLowerCase()})};checkOriginMatch=function(b,a,c){if(typeof a==="function"){a(b,function(e,d){c(e,d)})}else{if(a.length>0){c(null,a.some(function(d){return d===b}))}else{c(null,true)}}};exports.create=function(a){a=a||{};a.origins=a.origins||[];a.methods=a.methods||simpleMethods;if(a.hasOwnProperty("requestHeaders")===true){a.requestHeaders=toLowerCase(a.requestHeaders)}else{a.requestHeaders=simpleRequestHeaders}if(a.hasOwnProperty("responseHeaders")===true){a.responseHeaders=toLowerCase(a.responseHeaders)}else{a.responseHeaders=simpleResponseHeaders}a.maxAge=a.maxAge||null;a.supportsCredentials=a.supportsCredentials||false;if(a.hasOwnProperty("endPreflightRequests")===false){a.endPreflightRequests=true}return function(i,h,e){var c,b,f,g,j,d;if(!i.headers.hasOwnProperty("origin")){e()}else{checkOriginMatch(i.headers.origin,a.origins,function(l,k){if(l!==null){e(l)}else{if(typeof k!=="boolean"||k===false){e()}else{if(i.method==="OPTIONS"){d=function(){if(a.endPreflightRequests===true){h.writeHead(204);h.end()}else{e()}};if(!i.headers.hasOwnProperty("access-control-request-method")){d()}else{f=i.headers["access-control-request-method"];if(i.headers.hasOwnProperty("access-control-request-headers")){g=toLowerCase(i.headers["access-control-request-headers"].split(/,\s*/))}else{g=[]}c=a.methods.indexOf(f)!==-1;if(c===false){d()}else{b=g.every(function(m){if(m==="origin"){return true}else{if(a.requestHeaders.indexOf(m)!==-1){return true}else{return false}}});if(b===false){d()}else{if(a.supportsCredentials===true){h.setHeader("Access-Control-Allow-Origin",i.headers.origin);h.setHeader("Access-Control-Allow-Credentials","true")}else{if(a.origins.length>0||typeof a.origins==="function"){h.setHeader("Access-Control-Allow-Origin",i.headers.origin)}else{h.setHeader("Access-Control-Allow-Origin","*")}}if(a.maxAge!==null){h.setHeader("Access-Control-Max-Age",a.maxAge)}h.setHeader("Access-Control-Allow-Methods",a.methods.join(","));h.setHeader("Access-Control-Allow-Headers",a.requestHeaders.join(","));d()}}}}else{if(a.supportsCredentials===true){h.setHeader("Access-Control-Allow-Origin",i.headers.origin);h.setHeader("Access-Control-Allow-Credentials","true")}else{if(a.origins.length>0||typeof a.origins==="function"){h.setHeader("Access-Control-Allow-Origin",i.headers.origin)}else{h.setHeader("Access-Control-Allow-Origin","*")}}j=a.responseHeaders.filter(function(m){return simpleResponseHeaders.indexOf(m)===-1});if(j.length>0){h.setHeader("Access-Control-Expose-Headers",j.join(","))}e()}}}})}}};