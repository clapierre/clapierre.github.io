var http=require("http"),https=require("https"),web_o=require("./web-outgoing"),common=require("../common"),passes=exports;web_o=Object.keys(web_o).map(function(t){return web_o[t]}),[function(t){"DELETE"!==t.method&&"OPTIONS"!==t.method||t.headers["content-length"]||(t.headers["content-length"]="0")},function(t,e,o){o.timeout&&t.socket.setTimeout(o.timeout)},function(t,e,o){if(o.xfwd){var r=t.isSpdy||common.hasEncryptedConnection(t),n={"for":t.connection.remoteAddress||t.socket.remoteAddress,port:common.getPort(t),proto:r?"https":"http"};["for","port","proto"].forEach(function(e){t.headers["x-forwarded-"+e]=(t.headers["x-forwarded-"+e]||"")+(t.headers["x-forwarded-"+e]?",":"")+n[e]})}},function(t,e,o,r,n,s){function i(r){s?s(r,t,e,o.target):n.emit("error",r,t,e,o.target)}if(n.emit("start",t,e,o.target),o.forward){var p=("https:"===o.forward.protocol?https:http).request(common.setupOutgoing(o.ssl||{},o,t,"forward"));if((o.buffer||t).pipe(p),!o.target)return e.end()}var u=("https:"===o.target.protocol?https:http).request(common.setupOutgoing(o.ssl||{},o,t));u.on("socket",function(){n&&n.emit("proxyReq",u,t,e,o)}),o.proxyTimeout&&u.setTimeout(o.proxyTimeout,function(){u.abort()}),t.on("aborted",function(){u.abort()}),t.on("error",i),u.on("error",i),(o.buffer||t).pipe(u),u.on("response",function(r){n&&n.emit("proxyRes",r,t,e);for(var s=0;s<web_o.length&&!web_o[s](t,e,r,o);s++);r.on("end",function(){n.emit("end",t,e,r)}),r.pipe(e)})}].forEach(function(t){passes[t.name]=t});