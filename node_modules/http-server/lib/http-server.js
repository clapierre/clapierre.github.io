var fs=require("fs"),util=require("util"),union=require("union"),ecstatic=require("ecstatic"),httpProxy=require("http-proxy"),corser=require("corser");var HTTPServer=exports.HTTPServer=function(b){b=b||{};if(b.root){this.root=b.root}else{try{fs.lstatSync("./public");this.root="./public"}catch(d){this.root="./"}}this.headers=b.headers||{};this.cache=b.cache||3600;this.showDir=b.showDir!=="false";this.autoIndex=b.autoIndex!=="false";if(b.ext){this.ext=b.ext===true?"html":b.ext}var e=b.before?b.before.slice():[];e.push(function(g,f){if(b.logFn){b.logFn(g,f)}f.emit("next")});if(b.cors){this.headers["Access-Control-Allow-Origin"]="*";this.headers["Access-Control-Allow-Headers"]="Origin, X-Requested-With, Content-Type, Accept";e.push(corser.create())}if(b.robots){e.push(function(g,f){if(g.url==="/robots.txt"){f.setHeader("Content-Type","text/plain");var h=b.robots===true?"User-agent: *\nDisallow: /":b.robots.replace(/\\n/,"\n");return f.end(h)}f.emit("next")})}e.push(ecstatic({root:this.root,cache:this.cache,showDir:this.showDir,autoIndex:this.autoIndex,defaultExt:this.ext,handleError:typeof b.proxy!=="string"}));if(typeof b.proxy==="string"){var c=httpProxy.createProxyServer({});e.push(function(g,f){c.web(g,f,{target:b.proxy,changeOrigin:true})})}var a={before:e,headers:this.headers,onError:function(h,g,f){if(b.logFn){b.logFn(g,f,h)}f.end()}};if(b.https){a.https=b.https}this.server=union.createServer(a)};HTTPServer.prototype.listen=function(){this.server.listen.apply(this.server,arguments)};HTTPServer.prototype.close=function(){return this.server.close()};exports.createServer=function(a){return new HTTPServer(a)};