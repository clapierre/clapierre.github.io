define(["underscore"],function(d){var a=/[\r\n\u2028\u2029"\t]/;function c(o){var l=/(.*)(?:\n|\r\n|\r|\u2028|\u2029)/mg,i=/(.*?)(?:\t|(\n|\r\n|\r|\u2028|\u2029|$))/g,m=/^("(?:[^"]|"")*")(?:\t|(\n|\r\n|\r|\u2028|\u2029|$))/,h=/""/g,p=o.length,k=0;function n(q){if(q<=k){throw new Error("last index "+k+" -> "+q)}k=q}function j(){if(k>=p){return null}l.lastIndex=k;var q=l.exec(o);if(q&&q[1].indexOf('"')===-1){n(l.lastIndex);return q[1].split("\t")}return g()}function g(){var q,r,s=[];i.lastIndex=k;do{q=i.exec(o);if(q[1][0]==='"'){r=m.exec(o.slice(k));if(r&&r[1]){q=r;q[1]=q[1].slice(1,-1).replace(h,'"');i.lastIndex=k+q[0].length}}s.push(q[1]);n(i.lastIndex)}while(k<p&&d.isUndefined(q[2]));return s}return j}function b(j,g){var i=[],h=c(j),k=h();while(k){i.push(k);if(g&&i.length>=g){break}k=h()}return i}function e(g){if(g===null||d.isUndefined(g)){g=""}else{g=String(g)}if(a.test(g)){g='"'+g.replace(/"/g,'""')+'"'}return g}function f(g){return d.map(g,function(h){return d.map(h,e).join("\t")}).join("\n")}return{escape:e,makeRowParser:c,parseRows:b,tabDelimit:f}});