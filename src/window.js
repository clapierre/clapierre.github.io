define(["jquery","vellum/core","vellum/jquery-extensions"],function(b){b.vellum.plugin("windowManager",{minHeight:200,bottomOffset:0},{init:function(){var f=this,e=this.opts().windowManager,d=function(){f.adjustToWindow()};a(this.$f.find(".fd-scrollable"));c(this.$f.find(".fd-content-divider"),this.$f.find(".fd-content-left"),d);c(this.$f.find(".fd-content-left-divider"),this.$f.find(".fd-accessory-pane"),d);this.data.windowManager.offset={top:e.topOffset||this.$f.offset().top-1,bottom:e.bottomOffset||0,left:e.leftOffset||this.$f.offset().left};this.data.windowManager.fullscreen=e.fullscreen;this.data.windowManager.adjustToWindow=d;b(window).resize(d);b(document).scroll(d);b(document).ready(d);this.adjustToWindow()},adjustToWindow:function(){if(!this.$f.is(":visible")){return}var d=b(window).height()-this.getCurrentTopOffset(),e,h=(this.getCurrentTopOffset()===0)?"fixed":"static",l=this.$f.find(".fd-ui-container");if(this.data.windowManager.fullscreen){l.parent().css({height:null,width:null});l.css({height:null,width:null});l.parent().css({position:"fixed",top:0,bottom:0,left:0,right:0,zIndex:10000,backgroundColor:"white"})}else{l.parent().css({position:"",top:"",bottom:"",left:"",right:"",backgroundColor:"white"})}l.parent().css("height",d+"px");d=d-this.getCurrentBottomOffset();l.css("height",d+"px");l.css("width",l.parent().width()).css("position",h).css("left",this.getCurrentLeftOffset()+"px");e=l.width();var n=this.$f.find(".fd-toolbar").outerHeight(false),f=d-n,j=Math.max(f,this.opts().windowManager.minHeight),k=j-this.$f.find(".fd-head").outerHeight(false),m=k,g=this.$f.find(".fd-accessory-pane");l.find(".fd-content").css("height",j+"px");if(g.children().length){var i=g.outerHeight(false),o=i-g.find(".fd-head").outerHeight(true);m-=2+i+this.$f.find(".fd-content-left-divider").outerHeight(true);g.find(".fd-scrollable").css("height",o+"px");g.show();this.$f.find(".fd-content-left-divider").show()}else{g.hide();this.$f.find(".fd-content-left-divider").hide()}l.find(".fd-content-left").find(".fd-tree").find(".fd-scrollable").css("height",m+"px");l.find(".fd-content-right").css("width",e-this.getLeftWidth()+"px").find(".fd-scrollable.full").css("height",k+"px");l.find(".fd-props-scrollable").css("height",k-l.find(".fd-props-toolbar").outerHeight(true)+"px")},getLeftWidth:function(){return 2+this.$f.find(".fd-content-left").outerWidth(false)+this.$f.find(".fd-content-divider").outerWidth(true)},getCurrentTopOffset:function(){if(this.data.windowManager.fullscreen){return 0}var d=b(window).scrollTop(),f=this.data.windowManager.offset,e=(typeof f.top==="function")?f.top():f.top;return Math.min(Math.max(e-d,0),e)},getCurrentBottomOffset:function(){if(this.data.windowManager.fullscreen){return 0}var d=this.data.windowManager.offset;return(typeof d.bottom==="function")?d.bottom():d.bottom},getCurrentLeftOffset:function(){if(this.data.windowManager.fullscreen){return 0}var f=b(window).scrollLeft(),e=this.data.windowManager.offset,d=(typeof e.left==="function")?e.left():e.left;return Math.min(d-f,d)}});function a(d){d.on("DOMMouseScroll mousewheel",function(i){var k=b(this),j=this.scrollTop,h=this.scrollHeight,f=k.height(),l=i.originalEvent.wheelDelta,e=l>0,g=function(){i.stopPropagation();i.preventDefault();i.returnValue=false;return false};if(!e&&-l>h-f-j){k.scrollTop(h);return g()}else{if(e&&l>j){k.scrollTop(0);return g()}}})}function c(f,e,g){var i,d,h,k;if(f.hasClass("fd-content-vertical-divider")){h=e.offset().left<f.offset().left;i="pageX";d="width";k="col-resize"}else{h=e.offset().top<f.offset().top;i="pageY";d="height";k="row-resize"}var j=h?1:-1;f.mousedown(function(m){var o=e.data("min-size")||0,n=e[d](),l=function(p){var q=p[i]-m[i];e[d](Math.max(n+q*j,o));e.resize();g()};b(window).disableSelection().on("mousemove",l).one("mouseup",function(){b(this).enableSelection();b(this).off("mousemove",l)})}).hover(function(l){l.target.style.cursor=k})}return{preventDoubleScrolling:a}});