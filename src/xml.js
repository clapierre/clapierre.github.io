define(["jquery","underscore"],function(e,b){function a(h,f){if(!h){return""}else{if(b.isString(h)){if(!/[<>&]/.test(h)){return h}h=f?e(h):e("<div />").append(c(h))}}var g=new XMLSerializer(),j=/^<([\w:.-]+)(?:\s+[\w:.-]+=(["'])[^]*?\2)*\s*(?:\/>|>([^]*)<\/\1>)$/g,i=/<(([\w:.-]+)(?:\s+[\w:.-]+=(["'])[^]*?\3)*\s*)><\/\2>/g;return g.serializeToString(h[0]).replace(j,"$3").replace(i,"<$1 />").replace(/&nbsp;|\xa0/g," ")}function d(i,g){if(!i){return""}else{if(b.isString(i)&&i.indexOf("&")===-1){return i}}var h=a(i,g),f=/(?:&lt;(=?\s)|(\s)&gt;|&amp;(\s))/g;return h.replace(f,function(m,j,k,l){return j?("<"+j):(k?(k+">"):("&"+l))})}function c(g){var f=/<(([\w:.-]+)(?:\s+[\w:.-]+=(["'])[^]*?\3)*\s*)\/>/g;return g.replace(f,"<$1></$2>")}return{normalize:a,humanize:d}});