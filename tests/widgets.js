require(["chai","jquery","underscore","tests/utils","vellum/expressionEditor","vellum/util"],function(e,d,h,f,c,g){var a=e.assert,b=c.showXPathEditor,i={};g.eventuality(i);c.showXPathEditor=function(){b.apply(null,arguments);i.fire("showXPathEditor")};describe("The widgets module",function(){before(function(j){f.init({javaRosa:{langs:["en"]},core:{onReady:function(){a(this.isPluginEnabled("modeliteration"),"modeliteration plugin should be enabled");j()}}})});it("xPath widget should show newlines in advanced mode",function(j){f.loadXML("");var l='"line 1 \n line 2"',m='"line 1 &#10; line 2"';f.addQuestion("DataBindOnly","hidden",{calculateAttr:l});f.clickQuestion("/data/hidden");var k=d("[name=property-calculateAttr]");a.equal(k.val(),m);k.closest(".control-group").find(".fd-edit-button").click();i.on("showXPathEditor",function(){var n=d(".xpath-advanced").find("textarea").val();d(".fd-xpath-cancel-button").click();a.equal(n,l,"textarea content should have newline");j()},null,"showXPathEditor")});it("xPath widget should escape newlines on save advanced mode",function(j){f.loadXML("");var m='"line 1 \n line 2"',n='"line 1 &#10; line 2"',l=f.addQuestion("DataBindOnly","hidden",{calculateAttr:""});f.clickQuestion("/data/hidden");var k=d("[name=property-calculateAttr]");k.closest(".control-group").find(".fd-edit-button").click();i.on("showXPathEditor",function(){var o=d(".xpath-advanced").find("textarea");o.val(m).change();d(".fd-xpath-save-button").click();var p=d("[name=property-calculateAttr]");a.equal(p.val(),n,"input value not escaped");a.equal(l.p.calculateAttr,m,"wrong mug value");j()},null,"showXPathEditor")})})});