define(["tests/utils","chai","jquery","underscore","vellum/saveToCase","text!static/saveToCase/create_property.xml","text!static/saveToCase/close_property.xml","text!static/saveToCase/update_property.xml","text!static/saveToCase/index_property.xml","text!static/saveToCase/attachment_property.xml","text!static/saveToCase/create_2_property.xml",],function(h,g,f,k,c,e,l,d,i,j,b){var a=g.assert,m=h.call;describe("The SaveToCase module",function(){before(function(n){h.init({javaRosa:{langs:["en"]},core:{onReady:n}})});it("should load and save a create property",function(){h.loadXML(e);var n=h.getMug("save_to_case"),o=n.p.createProperty;a.equal(o.case_type.calculate,"caseType");a.equal(o.case_name.calculate,"/data/name");a.equal(n.p.useCreate,true);a.equal(o.owner_id.calculate,"/data/meta/userID");a.equal(n.p.date_modified,"/data/meta/timeEnd");a.equal(n.p.user_id,"/data/meta/userID");h.assertXmlEqual(m("createXML"),e)});it("should load and save a close property",function(){h.loadXML(l);var n=h.getMug("save_to_case");a.equal(n.p.useClose,true);a.equal(n.p.closeCondition,"1=1");a.equal(n.p.date_modified,"/data/meta/timeEnd");a.equal(n.p.user_id,"/data/meta/userID");a.equal(n.p.case_id,"/data/meta/caseID");h.assertXmlEqual(m("createXML"),l)});it("should load and save a update property",function(){h.loadXML(d);var n=h.getMug("save_to_case");a.equal(n.p.useUpdate,true);a(k.isEqual(n.p.updateProperty,{name:{relevant:"/data/name != ''",calculate:"/data/name"}}));a.equal(n.p.date_modified,"/data/meta/timeEnd");a.equal(n.p.user_id,"/data/meta/userID");a.equal(n.p.case_id,"/data/meta/caseID");h.assertXmlEqual(m("createXML"),d)});it("should load and save a index property",function(){h.loadXML(i);var n=h.getMug("save_to_case");a.equal(n.p.useIndex,true);a(k.isEqual(n.p.indexProperty,{extension:{calculate:"/data/meta/caseID",case_type:"extension_case",relationship:"extension",}}));a.equal(n.p.date_modified,"/data/meta/timeEnd");a.equal(n.p.user_id,"/data/meta/userID");a.equal(n.p.case_id,"/data/meta/caseID");h.assertXmlEqual(m("createXML"),i)});it("should load and save a attachment property",function(){h.loadXML(j);var n=h.getMug("save_to_case");a.equal(n.p.useAttachment,true);a(k.isEqual(n.p.attachmentProperty,{attach:{calculate:"/data/question1",from:"local",name:"name",}}));a.equal(n.p.date_modified,"/data/meta/timeEnd");a.equal(n.p.user_id,"/data/meta/userID");a.equal(n.p.case_id,"/data/meta/caseID");h.assertXmlEqual(m("createXML"),j)});k.each({"inline attachments":{inline_prop:{calculate:"/data/question1",from:"inline",}},"from strings":{from_strings:{calculate:"/data/question1",from:"blah"}}},function(o,n){it("should validate "+n,function(){h.loadXML("");var q=h.addQuestion("SaveToCase","save"),p=q.spec.attachmentProperty;q.p.useAttachment=true;q.p.attachmentProperty=o;a.notEqual(p.validationFunc(q),"pass")})});it("should load 2 create setvalues",function(){h.loadXML(b);var o=h.getMug("create1"),n=h.getMug("create2");a.equal(o.p.case_id,"1");a.equal(n.p.case_id,"2");h.assertXmlEqual(m("createXML"),b)});it("should load and save a index property",function(){h.loadXML(i);h.clickQuestion("save_to_case");f("#fd-question-edit-update").find(".fd-add-property").click();h.assertXmlEqual(m("createXML"),i)})})});