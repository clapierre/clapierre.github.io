require(["chai","jquery","underscore","tests/utils","vellum/parser","text!static/parser/other_item.xml","text!static/parser/label-without-itext.xml","text!static/parser/missing-bind.xml"],function(h,f,n,i,b,k,d,e){var a=h.assert,o=i.call,c=i.options.options.plugins||[],g=n.union(c,["itemset"]),j=n(c).without("itemset");describe("The parser",function(){it("can detect when the itemset plugin is enabled",function(q){i.init({plugins:g,core:{onReady:function(){a(this.isPluginEnabled("itemset"),"itemset plugin should be enabled");q()}}})});it("can detect when the itemset plugin is disabled",function(q){i.init({plugins:j,core:{onReady:function(){a(!this.isPluginEnabled("itemset"),"itemset plugin should be disabled");q()}}})});it("should gracefully handle itemset when the itemset plugin is disabled",function(q){i.init({plugins:j,core:{form:m,onReady:function(){var r=o("getMugByPath","/data/state");a.equal(r.__className,"Select");var s=o("createXML"),t=f(f.parseXML(s));a.equal(t.find("instance[id=states]").length,1,s);a.equal(t.find("itemset").attr("nodeset"),"instance('states')/state_list/state");q()}}})});it("should not drop newlines in calculate conditions",function(){i.loadXML(l);var q=o("getMugByPath","/data/question1");a.equal(q.p.calculateAttr,'concat("Line 1","\nLine 2")')});var p=/Form (JRM namespace|does not have a (Name|(UI)?Version))/;it("should load select item without itext",function(){i.loadXML(k,null,p);var q=o("getMugByPath","/ClassroomObservationV3/Q0003"),r=q._node_control.children[1].value;a.equal(r.p.nodeID,"other")});it("should load mugs with relative paths and label without itext",function(){i.loadXML(d,null,p);var r=o("getMugByPath","/data/group"),s=o("getMugByPath","/data/group/a"),q=o("getMugByPath","/data/text");a.equal(r.p.labelItext.defaultValue(),"The group");a.equal(s.p.labelItext.defaultValue(),"The label");a.equal(q.p.labelItext.defaultValue(),"The text");i.assertXmlNotEqual(o("createXML"),d)});it("should load question without bind element",function(){i.loadXML(e)})});var m='<?xml version="1.0" encoding="UTF-8" ?>    <h:html xmlns:h="http://www.w3.org/1999/xhtml" xmlns:orx="http://openrosa.org/jr/xforms" xmlns="http://www.w3.org/2002/xforms" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:jr="http://openrosa.org/javarosa" xmlns:vellum="http://commcarehq.org/xforms/vellum">        <h:head>            <h:title>Vellum testing</h:title>            <model>                <instance>                    <data xmlns:jrm="http://dev.commcarehq.org/jr/xforms"                          xmlns="http://openrosa.org/formdesigner/FFD00941-A932-471A-AEC8-87F6EFEF767F"                          uiVersion="1" version="1" name="Vellum testing">                        <state />                    </data>                </instance>                <instance id="states" src="jr://fixture/item-list:state"></instance>                <bind nodeset="/data/state" />                <itext>                    <translation lang="en" default="">                        <text id="state-label">                            <value>State</value>                        </text>                    </translation>                </itext>            </model>        </h:head>        <h:body>            <select1 ref="/data/state">                <label ref="jr:itext(\'state-label\')" />                <itemset nodeset="instance(\'states\')/state_list/state">                  <label ref="name"></label>                  <value ref="id"></value>                </itemset>            </select1>        </h:body>    </h:html>';var l=i.xmlines('<?xml version="1.0" encoding="UTF-8"?>    <h:html xmlns:h="http://www.w3.org/1999/xhtml" xmlns:orx="http://openrosa.org/jr/xforms" xmlns="http://www.w3.org/2002/xforms" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:jr="http://openrosa.org/javarosa" xmlns:vellum="http://commcarehq.org/xforms/vellum">        <h:head>            <h:title>Untitled Form</h:title>            <model>                <instance>                    <data xmlns:jrm="http://dev.commcarehq.org/jr/xforms" xmlns="http://openrosa.org/formdesigner/398C9010-61DC-42D3-8A85-B857AC3A9CA0" uiVersion="1" version="1" name="Untitled Form">                        <question1 />                    </data>                </instance>                <bind nodeset="/data/question1" calculate="concat(&quot;Line 1&quot;,&quot;&#10;Line 2&quot;)" />                <itext>                    <translation lang="en" default=""/>                </itext>            </model>        </h:head>        <h:body></h:body>    </h:html>')});